<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Sijil Berhenti Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan fon Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Menambah baik 'focus ring' untuk input */
        input:focus, textarea:focus, select:focus {
            box-shadow: 0 0 0 2px #6366f1; /* Indigo-500 shadow */
            border-color: #6366f1 !important;
        }
        
        /* === STYLE BARU UNTUK INPUT === */
        
        /* Gaya untuk Input yang Boleh Diisi (Untuk Kontras yang Lebih Baik) */
        .input-aktif {
            background-color: #f9fafb; /* Gray-50/100 */
            border: 1px solid #d1d5db; /* Gray-300 */
        }

        /* Gaya untuk Input Readonly/Disabled (Kontras Jelas & Rupa Berbeza) */
        .input-readonly-styled {
            background-color: #ffffff !important; /* Putih */
            color: #4b5563 !important; /* Gray-600 */
            border: none !important;
            border-bottom: 2px solid #9ca3af !important; /* Sempadan bawah yang jelas */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            cursor: default;
        }
        .input-readonly-styled::placeholder {
            color: #9ca3af; /* Gray-400 */
        }

        /* Style untuk checkbox container */
        .minat-item {
            padding: 5px 0;
            border-bottom: 1px dashed #e5e7eb;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 text-gray-800">

    <div class="max-w-3xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">Borang Sijil Berhenti Sekolah</h1>
            <p class="text-gray-600 mt-2">
                Sila lengkapkan maklumat murid di bawah untuk simpanan data.
            </p>
        </div>

        <div class="grid grid-cols-1 gap-8">
            
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-xl">
                <form id="sijil-form" class="space-y-6">
                    
                    <fieldset>
                        <legend class="text-xl font-semibold text-indigo-600 border-b border-indigo-100 pb-3 mb-4">Maklumat Asas Murid</legend>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="no-ic" class="block text-sm font-medium text-gray-700">Nombor IC (12 digit, tanpa -)</label>
                                <input type="text" id="no-ic" maxlength="12" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif" placeholder="Cth: 050115101234">
                            </div>

                            <div>
                                <label for="nama-murid" class="block text-sm font-medium text-gray-700">Nama Murid (Nama Penuh)</label>
                                <input type="text" id="nama-murid" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="tempat-lahir" class="block text-sm font-medium text-gray-700">Tempat Lahir</label>
                                    <input type="text" id="tempat-lahir" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                                </div>
                                <div>
                                    <label for="tarikh-lahir" class="block text-sm font-medium text-gray-700">Tarikh Lahir (Automatik dari IC)</label>
                                    <input type="date" id="tarikh-lahir" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-readonly-styled" readonly>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div>
                                    <label for="jantina" class="block text-sm font-medium text-gray-700">Jantina (Automatik dari IC)</label>
                                    <input type="text" id="jantina" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-readonly-styled" readonly>
                                </div>
                                <div>
                                    <label for="warganegara" class="block text-sm font-medium text-gray-700">Warganegara / Nationality</label>
                                    <input type="text" id="warganegara" value="MALAYSIA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                                </div>
                                <div>
                                    <label for="kumpulan-etnik" class="block text-sm font-medium text-gray-700">Kumpulan Etnik</label>
                                    <input type="text" id="kumpulan-etnik" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif" placeholder="Cth: MELAYU, CINA, IBAN">
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-xl font-semibold text-indigo-600 border-b border-indigo-100 pb-3 mb-4 pt-4">Maklumat Bapa/Ibu/Penjaga</legend>
                        <div class="space-y-4">
                            <div>
                                <label for="nama-penjaga" class="block text-sm font-medium text-gray-700">Nama Bapa/Ibu/Penjaga</label>
                                <input type="text" id="nama-penjaga" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div>
                                <label for="alamat-penjaga" class="block text-sm font-medium text-gray-700">Alamat Bapa/Ibu/Penjaga</label>
                                <textarea id="alamat-penjaga" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif"></textarea>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-xl font-semibold text-indigo-600 border-b border-indigo-100 pb-3 mb-4 pt-4">Maklumat Persekolahan</legend>
                        <div class="space-y-4">
                            <div>
                                <label for="sekolah" class="block text-sm font-medium text-gray-700">Sekolah / School</label>
                                <input type="text" id="sekolah" value="SMK LUTONG, MIRI" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="bahasa-pengantar" class="block text-sm font-medium text-gray-700">Bahasa Pengantar</label>
                                    <input type="text" id="bahasa-pengantar" value="BAHASA MELAYU" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                                </div>
                                <div>
                                    <label for="tarikh-masuk" class="block text-sm font-medium text-gray-700">Tarikh Kemasukan / Date of Admission</label>
                                    <input type="date" id="tarikh-masuk" value="2021-01-20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                                </div>
                            </div>

                            
                            <div>
                                <label for="tarikh-berhenti" class="block text-sm font-medium text-gray-700">Tarikh Berhenti / Date of Leaving</label>
                                <input type="date" id="tarikh-berhenti" value="2025-12-19" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            
                            <div>
                                <label for="tingkatan-tertinggi" class="block text-sm font-medium text-gray-700">Darjah/Tingkatan Tertinggi Dihadiri</label>
                                <input type="text" id="tingkatan-tertinggi" value="5 BAKTI" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div>
                                <label for="sebab-berhenti" class="block text-sm font-medium text-gray-700">Sebab Berhenti / Reason for Leaving</label>
                                <input type="text" id="sebab-berhenti" value="TAMAT TINGKATAN LIMA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div>
                                <label for="peperiksaan-awam" class="block text-sm font-medium text-gray-700">Peperiksaan Awam Diduduki</label>
                                <input type="text" id="peperiksaan-awam" value="SIJIL PELAJARAN MALAYSIA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                            <div>
                                <label for="sekolah-terdahulu" class="block text-sm font-medium text-gray-700">Sekolah Terdahulu / Schools Previously Attended</label>
                                <input type="text" id="sekolah-terdahulu" value="TIADA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-aktif">
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-xl font-semibold text-indigo-600 border-b border-indigo-100 pb-3 mb-4 pt-4">Minat atau Kebolehan Khas (Pilih maks. 3)</legend>
                        <div id="minat-options-container" class="space-y-1">
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM BIDANG SAINS DAN TEKNOLOGI" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam bidang sains dan teknologi</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM AKTIVITI KOKURIKULUM" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam aktiviti kokurikulum</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT MEMBACA BAHAN ILMIAH" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat membaca bahan ilmiah</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM SENI VISUAL" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam seni visual</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM MATEMATIK" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam matematik</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM PENULISAN KREATIF" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam penulisan kreatif</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM MUZIK" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam muzik</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM SUKAN" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Minat dalam sukan (cth: bola jaring, badminton, olahraga)</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN MEMIMPIN DAN BEKERJA DALAM KUMPULAN" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan memimpin dan bekerja dalam kumpulan</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN KOMUNIKASI YANG BAIK" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan komunikasi yang baik</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN BERFIKIR SECARA KRITIS DAN MENYELESAIKAN MASALAH" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan berfikir secara kritis dan menyelesaikan masalah</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN DALAM PENGATURCARAAN ASAS / ICT" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan dalam pengaturcaraan asas / ICT</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN SENI PERSEMBAHAN" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan seni persembahan</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN MELUKIS ATAU MENGHASILKAN KARYA SENI" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan melukis atau menghasilkan karya seni</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN AKADEMIK YANG KONSISTEN" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan akademik yang konsisten</label></div>
                            <div class="flex items-start minat-item"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN DALAM SUKAN TERTENTU" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"><label class="ml-2 text-sm text-gray-700">Kebolehan dalam sukan tertentu</label></div>
                            
                            <div class="flex items-center pt-2">
                                <input type="checkbox" id="minat-lain-checkbox" name="minat-checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="minat-lain-checkbox" class="ml-2 text-sm font-medium text-gray-700">Lain-lain:</label>
                                <input type="text" id="minat-lain-text" class="ml-2 flex-1 rounded-md border-gray-300 shadow-sm sm:text-sm focus:border-indigo-500 focus:ring-indigo-500 input-readonly-styled" disabled>
                            </div>
                        </div>
                        <div id="minat-error" class="text-red-600 text-sm mt-1 hidden">Anda hanya boleh pilih 3 minat/kebolehan.</div>
                        
                        <div>
                            <label for="minat-khas" class="block text-sm font-medium text-gray-700 mt-4">Ringkasan Minat / Kebolehan Khas</label>
                            <textarea id="minat-khas" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-readonly-styled" readonly placeholder="Pilihan anda akan digabungkan di sini..."></textarea>
                        </div>
                    </fieldset>


                    <fieldset>
                        <legend class="text-xl font-semibold text-indigo-600 border-b border-indigo-100 pb-3 mb-4 pt-4">Komen</legend>
                        <div>
                            <label for="komen-pengetua" class="block text-sm font-medium text-gray-700">Komen Guru Besar/Pengetua (Dijana Automatik)</label>
                            <textarea id="komen-pengetua" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 input-readonly-styled" readonly></textarea>
                        </div>
                    </fieldset>

                    <div class="pt-6 border-t border-gray-200">
                        <h2 class="text-lg font-semibold pb-2">Hantar Maklumat</h2>
                        
                        <details class="bg-gray-50 border border-gray-200 rounded-md p-3 mb-4 hidden">
                            <summary class="text-sm font-medium text-gray-700 cursor-pointer">Arahan Persediaan SheetDB (Untuk Admin)</summary>
                            <div class="mt-3 text-sm text-gray-600 space-y-2">
                                <p><strong>Langkah 1:</strong> Buat satu Google Sheet baru.</p>
                                <p><strong>Langkah 2:</strong> Di baris pertama (header), anda <strong>MESTI</strong> taip nama lajur (headings) ini *tepat-tepat* seperti di bawah:</p>
                                <code class="block bg-gray-200 p-2 rounded text-xs overflow-x-auto">
                                    IC, Nama Murid, Tempat Lahir, Tarikh Lahir, Jantina, Warganegara, Etnik, Nama Penjaga, Alamat Penjaga, Sekolah, Bahasa Pengantar, Tarikh Masuk, Tarikh Berhenti, Tingkatan Tertinggi, Sebab Berhenti, Peperiksaan Awam, Sekolah Terdahulu, Minat / Kebolehan Khas, Komen Pengetua
                                </code>
                                <p><strong>Langkah 3:</strong> Pergi ke laman web <a href="https://sheetdb.io/" target="_blank" class="text-blue-600 hover:underline">SheetDB.io</a> dan daftar akaun percuma.</p>
                                <p><strong>Langkah 4:</strong> Klik "Create New API". Kongsi Google Sheet anda (gunakan pautan "Anyone with the link can edit") dan tampal pautan Google Sheet anda ke dalam SheetDB.</p>
                                <p><strong>Langkah 5:</strong> SheetDB akan memberi anda satu "API URL". Salin URL itu dan tampal di bawah.</p>
                            </div>
                        </details>
                        
                        <input type="hidden" id="sheetdb-url" value="https://sheetdb.io/api/v1/VJ0QYRSKTFYY0">
                        
                        <div class="mt-4">
                            <button type="button" id="hantar-sheet-btn" class="w-full inline-flex justify-center items-center rounded-md bg-indigo-600 px-4 py-3 text-base font-semibold text-white shadow-lg hover:bg-indigo-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition duration-150 ease-in-out">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.875L5.999 12zm0 0h7.5" />
                                </svg>
                                <span id="hantar-teks">Hantar kepada guru kelas</span>
                            </button>
                        </div>
                        
                        <div id="sheet-status-mesej" class="mt-4 text-sm font-medium text-center hidden"></div>
                    </div>
                    </form>

                <div id="success-message" class="text-center p-8 hidden">
                    <svg class="mx-auto h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 16.5 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold text-green-700">Terima Kasih!</h2>
                    <p class="mt-2 text-gray-600">Maklumat anda telah berjaya dihantar kepada guru kelas.</p>
                </div>

            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold text-gray-900">Sahkan Penghantaran</h3>
            <p class="mt-2 text-sm text-gray-600">Anda pasti semua maklumat yang diisi adalah betul dan ingin menghantarnya sekarang?</p>
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="cancel-hantar-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    Batal
                </button>
                <button type="button" id="confirm-hantar-btn" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    Ya, Hantar
                </button>
            </div>
        </div>
    </div>


    <script type="module">
        // Pastikan DOM dimuat sepenuhnya sebelum menjalankan skrip
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Logik Auto-fill IC ---
            const icInput = document.getElementById('no-ic');
            const tarikhLahirInput = document.getElementById('tarikh-lahir');
            const jantinaInput = document.getElementById('jantina');

            icInput.addEventListener('input', (e) => {
                let ic = e.target.value.replace(/\D/g, ''); // Buang bukan digit
                if (ic.length > 12) {
                    ic = ic.substring(0, 12);
                }
                e.target.value = ic;

                if (ic.length === 12) {
                    // Ekstrak tarikh lahir (YYMMDD)
                    const tahun = ic.substring(0, 2);
                    const bulan = ic.substring(2, 4);
                    const hari = ic.substring(4, 6);
                    
                    // Tentukan abad (2000+ jika 00-sekarang, 1900+ jika > sekarang)
                    const tahunSemasa = new Date().getFullYear() % 100;
                    const abad = (parseInt(tahun, 10) <= (tahunSemasa + 1)) ? '20' : '19';
                    
                    if (tarikhLahirInput) {
                        tarikhLahirInput.value = `${abad}${tahun}-${bulan}-${hari}`;
                    }

                    // Ekstrak jantina (digit akhir)
                    const jantinaDigit = parseInt(ic.charAt(11), 10);
                    if (jantinaInput) {
                        jantinaInput.value = (jantinaDigit % 2 === 0) ? 'PEREMPUAN' : 'LELAKI';
                        jantinaInput.value = jantinaInput.value.toUpperCase();
                    }
                } else {
                    if (tarikhLahirInput) tarikhLahirInput.value = '';
                    if (jantinaInput) jantinaInput.value = '';
                }
            });

            // --- Logik Force Uppercase ---
            const forceUppercase = (e) => {
                if (e.target.id === 'no-ic') return;
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                e.target.value = e.target.value.toUpperCase();
                e.target.setSelectionRange(start, end);
            };

            const textInputs = document.querySelectorAll('input[type="text"], textarea');
            textInputs.forEach((input) => {
                input.addEventListener('input', forceUppercase);
            });

            // --- Logik Komen Rawak ---
            const komenTextarea = document.getElementById('komen-pengetua');
            const komenList = [
                "PELAJAR MENUNJUKKAN DISIPLIN YANG BAIK DAN MEMBERI KERJASAMA DALAM SEMUA AKTIVITI SEKOLAH.",
                "SEORANG PELAJAR YANG BERPOTENSI DAN BERKEUPAYAAN TINGGI DALAM AKADEMIK SERTA KOKURIKULUM.",
                "PELAJAR INI BERAKHLAK BAIK, BERDISIPLIN DAN MENUNJUKKAN SIKAP POSITIF TERHADAP PEMBELAJARAN.",
                "MEMILIKI SEMANGAT BELAJAR YANG BAIK DAN SENTIASA BERUSAHA MENINGKATKAN PENCAPAIAN DIRI.",
                "PELAJAR MENUNJUKKAN PERKEMBANGAN YANG MEMUASKAN DAN SENTIASA MENGHORMATI GURU SERTA RAKAN."
            ];
            
            if(komenTextarea) {
                const randomIndex = Math.floor(Math.random() * komenList.length);
                // Tambah kelas input-readonly-styled setelah nilai ditetapkan
                komenTextarea.value = komenList[randomIndex];
                komenTextarea.classList.add('input-readonly-styled');
            }

            // --- Logik Pilihan Minat (Checkboxes) ---
            const minatContainer = document.getElementById('minat-options-container');
            if (minatContainer) { 
                const minatCheckboxes = minatContainer.querySelectorAll('input[name="minat-checkbox"]');
                const minatTextarea = document.getElementById('minat-khas');
                const minatError = document.getElementById('minat-error');
                const lainCheckbox = document.getElementById('minat-lain-checkbox');
                const lainText = document.getElementById('minat-lain-text');
                const MAX_MINAT = 3;

                const updateMinatTextarea = () => {
                    if (!minatTextarea) return;
                    const finalCheckedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    const selectedValues = finalCheckedBoxes.map(cb => {
                        if (cb.id === 'minat-lain-checkbox' && lainText) {
                            return lainText.value;
                        } else {
                            return cb.value;
                        }
                    });
                    minatTextarea.value = selectedValues.filter(val => val && val.trim() !== '').join(', ');
                };

                minatContainer.addEventListener('change', (e) => {
                    if (e.target.name !== 'minat-checkbox') return;

                    if (e.target.id === 'minat-lain-checkbox' && lainText) {
                        lainText.disabled = !e.target.checked;
                        // Tambah atau buang kelas readonly
                        if (e.target.checked) {
                             lainText.classList.remove('input-readonly-styled');
                             lainText.classList.add('input-aktif');
                        } else {
                             lainText.classList.remove('input-aktif');
                             lainText.classList.add('input-readonly-styled');
                             lainText.value = '';
                        }
                    }

                    const checkedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    
                    if (checkedBoxes.length > MAX_MINAT) {
                        e.target.checked = false; 
                        if (e.target.id === 'minat-lain-checkbox' && lainText) {
                            lainText.disabled = true;
                            lainText.value = '';
                            lainText.classList.remove('input-aktif');
                            lainText.classList.add('input-readonly-styled');
                        }
                        if(minatError) minatError.classList.remove('hidden');
                        setTimeout(() => {
                            if(minatError) minatError.classList.add('hidden');
                        }, 2000);
                    } else {
                        if(minatError) minatError.classList.add('hidden');
                    }
                    
                    updateMinatTextarea();

                    const finalCheckedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    if (finalCheckedBoxes.length >= MAX_MINAT) {
                        minatCheckboxes.forEach(cb => {
                            if (!cb.checked) cb.disabled = true;
                        });
                    } else {
                        minatCheckboxes.forEach(cb => cb.disabled = false);
                    }
                });

                if(lainText) {
                    lainText.addEventListener('input', () => {
                        updateMinatTextarea(); 
                    });
                }
                
                // Set kelas readonly pada minat-khas (Ringkasan)
                if(minatTextarea) minatTextarea.classList.add('input-readonly-styled');
                // Set kelas readonly pada minat-lain-text (Lain-lain) pada permulaan
                if(lainText) lainText.classList.add('input-readonly-styled');
            }
            
            // Tambah kelas input-aktif pada input biasa yang belum ada style
            document.querySelectorAll('.mt-1.block.w-full.rounded-md:not([readonly]):not([disabled])').forEach(input => {
                if (!input.classList.contains('input-aktif')) {
                    input.classList.add('input-aktif');
                }
            });


            // === LOGIK HANTAR KE GOOGLE SHEET ===
            
            // Elemen Borang & Status
            const sijilForm = document.getElementById('sijil-form');
            const sheetdbUrlInput = document.getElementById('sheetdb-url');
            const hantarSheetBtn = document.getElementById('hantar-sheet-btn');
            const hantarTeks = document.getElementById('hantar-teks');
            const sheetStatusMesej = document.getElementById('sheet-status-mesej');
            
            // Elemen Modal
            const confirmModal = document.getElementById('confirm-modal');
            const cancelHantarBtn = document.getElementById('cancel-hantar-btn');
            const confirmHantarBtn = document.getElementById('confirm-hantar-btn');

            // Elemen Mesej Berjaya
            const successMessage = document.getElementById('success-message');


            const tunjukMesejSheet = (mesej, jenis = 'berjaya') => {
                if (!sheetStatusMesej) return;
                sheetStatusMesej.innerText = mesej;
                sheetStatusMesej.classList.remove('hidden', 'text-green-700', 'text-red-700');
                if (jenis === 'berjaya') {
                    sheetStatusMesej.classList.add('text-green-700');
                } else {
                    sheetStatusMesej.classList.add('text-red-700');
                }

                // Sembunyikan mesej jika ia bukan mesej 'berjaya' (kerana berjaya akan sembunyikan borang)
                if (jenis !== 'berjaya') {
                    setTimeout(() => {
                        sheetStatusMesej.classList.add('hidden');
                    }, 5000);
                }
            };
            
            const getValue = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : '';
            };

            // Fungsi kumpul data - 'No. Daftar Sekolah' DIBUANG
            const kumpulMaklumatJson = () => {
                return {
                    'IC': getValue('no-ic'),
                    'Nama Murid': getValue('nama-murid'),
                    'Tempat Lahir': getValue('tempat-lahir'),
                    'Tarikh Lahir': getValue('tarikh-lahir'),
                    'Jantina': getValue('jantina'),
                    'Warganegara': getValue('warganegara'),
                    'Etnik': getValue('kumpulan-etnik'),
                    'Nama Penjaga': getValue('nama-penjaga'),
                    'Alamat Penjaga': getValue('alamat-penjaga'),
                    'Sekolah': getValue('sekolah'),
                    'Bahasa Pengantar': getValue('bahasa-pengantar'),
                    'Tarikh Masuk': getValue('tarikh-masuk'),
                    'Tarikh Berhenti': getValue('tarikh-berhenti'),
                    'Tingkatan Tertinggi': getValue('tingkatan-tertinggi'),
                    'Sebab Berhenti': getValue('sebab-berhenti'),
                    'Peperiksaan Awam': getValue('peperiksaan-awam'),
                    'Sekolah Terdahulu': getValue('sekolah-terdahulu'),
                    'Minat / Kebolehan Khas': getValue('minat-khas'),
                    'Komen Pengetua': getValue('komen-pengetua')
                };
            };

            // Senarai medan wajib - 'No. Daftar Sekolah' DIBUANG
            const medanWajib = [
                ['no-ic', 'Nombor IC'],
                ['nama-murid', 'Nama Murid'],
                ['tempat-lahir', 'Tempat Lahir'],
                ['tarikh-lahir', 'Tarikh Lahir (automatik dari IC)'],
                ['jantina', 'Jantina (automatik dari IC)'],
                ['warganegara', 'Warganegara'],
                ['kumpulan-etnik', 'Kumpulan Etnik'],
                ['nama-penjaga', 'Nama Penjaga'],
                ['alamat-penjaga', 'Alamat Penjaga'],
                ['sekolah', 'Sekolah'],
                ['bahasa-pengantar', 'Bahasa Pengantar'],
                ['tarikh-masuk', 'Tarikh Masuk'],
                ['tarikh-berhenti', 'Tarikh Berhenti'],
                ['tingkatan-tertinggi', 'Tingkatan Tertinggi'],
                ['sebab-berhenti', 'Sebab Berhenti'],
                ['peperiksaan-awam', 'Peperiksaan Awam'],
                ['sekolah-terdahulu', 'Sekolah Terdahulu'],
                ['minat-khas', 'Minat / Kebolehan Khas (sila pilih)'],
                ['komen-pengetua', 'Komen Pengetua (automatik)']
            ];
            
            // Fungsi yang menjalankan Fetch (Penghantaran Sebenar)
            const lakukanPenghantaran = () => {
                const apiUrl = sheetdbUrlInput.value;
                if (!apiUrl || !apiUrl.startsWith('https://sheetdb.io/api/v1/')) {
                    tunjukMesejSheet("URL API SheetDB tidak sah. Sila semak semula.", 'gagal');
                    return;
                }

                const data = kumpulMaklumatJson();
                
                tunjukMesejSheet("Menghantar data...", 'berjaya');
                hantarSheetBtn.disabled = true;
                if (hantarTeks) hantarTeks.innerText = "Menghantar...";

                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: data })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.created) {
                        // BERJAYA! Sembunyikan borang, tunjuk mesej terima kasih.
                        if (sijilForm) sijilForm.classList.add('hidden');
                        if (successMessage) successMessage.classList.remove('hidden');
                        // Sembunyikan juga mesej "Menghantar data..."
                        if (sheetStatusMesej) sheetStatusMesej.classList.add('hidden');
                    } else {
                        console.error('Ralat SheetDB:', result);
                        tunjukMesejSheet("Gagal dihantar. Semak Konsol (F12) untuk ralat.", 'gagal');
                    }
                })
                .catch(error => {
                    console.error('Ralat Fetch:', error);
                    tunjukMesejSheet("Ralat berlaku. Sila periksa URL API dan sambungan internet anda.", 'gagal');
                })
                .finally(() => {
                    // Hanya aktifkan semula butang jika PENGHANTARAN GAGAL
                    // (Iaitu, jika mesej berjaya MASIH tersembunyi)
                    if (successMessage && successMessage.classList.contains('hidden')) { 
                        hantarSheetBtn.disabled = false;
                        if (hantarTeks) hantarTeks.innerText = "Hantar kepada guru kelas";
                    }
                });
            };

            // 1. Listener untuk BUTANG HANTAR UTAMA (Validasi & Tunjuk Modal)
            if(hantarSheetBtn) {
                hantarSheetBtn.addEventListener('click', () => {

                    // Validasi
                    let medanPertamaKosong = null;
                    for (const [id, nama] of medanWajib) {
                        const medan = document.getElementById(id);
                        if (!medan || !medan.value || medan.value.trim() === '') {
                            medanPertamaKosong = nama;
                            if (medan) {
                                medan.focus(); 
                            } else {
                                console.error(`Medan wajib hilang: ${id}`);
                            }
                            break;
                        }
                    }

                    if (medanPertamaKosong) {
                        tunjukMesejSheet(`Sila isi medan "${medanPertamaKosong}" terlebih dahulu.`, 'gagal');
                        return;
                    }

                    // Jika lulus validasi, tunjuk modal
                    if (confirmModal) {
                        confirmModal.classList.remove('hidden');
                    }
                });
            }

            // 2. Listener untuk butang "Batal" pada modal
            if (cancelHantarBtn && confirmModal) {
                cancelHantarBtn.addEventListener('click', () => {
                    confirmModal.classList.add('hidden');
                });
            }
            
            // 3. Listener untuk butang "Ya, Hantar" pada modal
            if (confirmHantarBtn && confirmModal) {
                confirmHantarBtn.addEventListener('click', () => {
                    confirmModal.classList.add('hidden');
                    lakukanPenghantaran(); // Panggil fungsi fetch sebenar
                });
            }

        }); // Tutup DOMContentLoaded
    </script>
</body>
</html>
