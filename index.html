<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Sijil Berhenti Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan fon Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="max-w-3xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Borang Sijil Berhenti Sekolah Kerajaan</h1>
        <p class="text-center text-gray-600 mb-8">
            Borang ini hanya untuk pengisian maklumat murid bagi tujuan cetakan semula pada sijil asli kelak.
        </p>

        <div class="grid grid-cols-1 gap-8">
            
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <form id="sijil-form" class="space-y-4">
                    
                    <h2 class="text-lg font-semibold border-b pb-2">Maklumat Asas Murid</h2>
                    
                    <div>
                        <label for="no-ic" class="block text-sm font-medium text-gray-700">Nombor IC (12 digit, tanpa -)</label>
                        <input type="text" id="no-ic" maxlength="12" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Cth: 050115101234">
                    </div>

                    <div>
                        <label for="nama-murid" class="block text-sm font-medium text-gray-700">Nama Murid (Nama Penuh)</label>
                        <input type="text" id="nama-murid" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="tempat-lahir" class="block text-sm font-medium text-gray-700">Tempat Lahir</label>
                            <input type="text" id="tempat-lahir" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="tarikh-lahir" class="block text-sm font-medium text-gray-700">Tarikh Lahir (Automatik dari IC)</label>
                            <input type="date" id="tarikh-lahir" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50" readonly>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div>
                            <label for="jantina" class="block text-sm font-medium text-gray-700">Jantina (Automatik dari IC)</label>
                            <input type="text" id="jantina" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50" readonly>
                        </div>
                        <div>
                            <label for="warganegara" class="block text-sm font-medium text-gray-700">Warganegara / Nationality</label>
                            <input type="text" id="warganegara" value="MALAYSIA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="kumpulan-etnik" class="block text-sm font-medium text-gray-700">Kumpulan Etnik</label>
                            <input type="text" id="kumpulan-etnik" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Cth: MELAYU, CINA, IBAN">
                        </div>
                    </div>

                    <h2 class="text-lg font-semibold border-b pt-4 pb-2">Maklumat Bapa/Ibu/Penjaga</h2>
                    <div>
                        <label for="nama-penjaga" class="block text-sm font-medium text-gray-700">Nama Bapa/Ibu/Penjaga</label>
                        <input type="text" id="nama-penjaga" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="alamat-penjaga" class="block text-sm font-medium text-gray-700">Alamat Bapa/Ibu/Penjaga</label>
                        <textarea id="alamat-penjaga" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>

                    <h2 class="text-lg font-semibold border-b pt-4 pb-2">Maklumat Persekolahan</h2>
                    <div>
                        <label for="sekolah" class="block text-sm font-medium text-gray-700">Sekolah / School</label>
                        <input type="text" id="sekolah" value="SMK LUTONG, MIRI" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="bahasa-pengantar" class="block text-sm font-medium text-gray-700">Bahasa Pengantar</label>
                            <input type="text" id="bahasa-pengantar" value="BAHASA MELAYU" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="tarikh-masuk" class="block text-sm font-medium text-gray-700">Tarikh Kemasukan / Date of Admission</label>
                            <input type="date" id="tarikh-masuk" value="2021-01-20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="no-daftar-sekolah" class="block text-sm font-medium text-gray-700">Nombor Pendaftaran Sekolah</label>
                            <input type="text" id="no-daftar-sekolah" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Cth: YEA5208">
                        </div>
                        <div>
                            <label for="tarikh-berhenti" class="block text-sm font-medium text-gray-700">Tarikh Berhenti / Date of Leaving</label>
                            <input type="date" id="tarikh-berhenti" value="2025-12-19" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                    </div>
                    <div>
                        <label for="tingkatan-tertinggi" class="block text-sm font-medium text-gray-700">Darjah/Tingkatan Tertinggi Dihadiri</label>
                        <input type="text" id="tingkatan-tertinggi" value="5 BAKTI" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="sebab-berhenti" class="block text-sm font-medium text-gray-700">Sebab Berhenti / Reason for Leaving</label>
                        <input type="text" id="sebab-berhenti" value="TAMAT TINGKATAN LIMA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="peperiksaan-awam" class="block text-sm font-medium text-gray-700">Peperiksaan Awam Diduduki</label>
                        <input type="text" id="peperiksaan-awam" value="SIJIL PELAJARAN MALAYSIA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="sekolah-terdahulu" class="block text-sm font-medium text-gray-700">Sekolah Terdahulu / Schools Previously Attended</label>
                        <input type="text" id="sekolah-terdahulu" value="TIADA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>

                    <h2 class="text-lg font-semibold border-b pt-4 pb-2">Minat atau Kebolehan Khas (Pilih maks. 3)</h2>
                    <div id="minat-options-container" class="space-y-2">
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM BIDANG SAINS DAN TEKNOLOGI" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam bidang sains dan teknologi</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM AKTIVITI KOKURIKULUM" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam aktiviti kokurikulum</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT MEMBACA BAHAN ILMIAH" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat membaca bahan ilmiah</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM SENI VISUAL" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam seni visual</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM MATEMATIK" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam matematik</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM PENULISAN KREATIF" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam penulisan kreatif</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM MUZIK" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam muzik</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="MINAT DALAM SUKAN" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Minat dalam sukan (cth: bola jaring, badminton, olahraga)</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN MEMIMPIN DAN BEKERJA DALAM KUMPULAN" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan memimpin dan bekerja dalam kumpulan</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN KOMUNIKASI YANG BAIK" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan komunikasi yang baik</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN BERFIKIR SECARA KRITIS DAN MENYELESAIKAN MASALAH" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan berfikir secara kritis dan menyelesaikan masalah</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN DALAM PENGATURCARAAN ASAS / ICT" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan dalam pengaturcaraan asas / ICT</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN SENI PERSEMBAHAN" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan seni persembahan</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN MELUKIS ATAU MENGHASILKAN KARYA SENI" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan melukis atau menghasilkan karya seni</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN AKADEMIK YANG KONSISTEN" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan akademik yang konsisten</label></div>
                        <div class="flex items-start"><input type="checkbox" name="minat-checkbox" value="KEBOLEHAN DALAM SUKAN TERTENTU" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><label class="ml-2 text-sm text-gray-700">Kebolehan dalam sukan tertentu</label></div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="minat-lain-checkbox" name="minat-checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="minat-lain-checkbox" class="ml-2 text-sm text-gray-700">Lain-lain:</label>
                            <input type="text" id="minat-lain-text" class="ml-2 flex-1 rounded-md border-gray-300 shadow-sm sm:text-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50" disabled>
                        </div>
                    </div>
                    <div id="minat-error" class="text-red-600 text-sm mt-1 hidden">Anda hanya boleh pilih 3 minat/kebolehan.</div>
                    
                    <div>
                        <label for="minat-khas" class="block text-sm font-medium text-gray-700 mt-3">Ringkasan Minat / Kebolehan Khas</label>
                        <textarea id="minat-khas" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50" readonly placeholder="Pilihan anda akan digabungkan di sini..."></textarea>
                    </div>
                    <div>
                        <label for="komen-pengetua" class="block text-sm font-medium text-gray-700">Komen Guru Besar/Pengetua (Dijana Automatik)</label>
                        <textarea id="komen-pengetua" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50" readonly></textarea>
                    </div>

                    <div class="pt-6 border-t border-gray-200">
                        <h2 class="text-lg font-semibold pb-2">Hantar Maklumat ke Google Sheet</h2>
                        
                        <details class="bg-gray-50 border border-gray-200 rounded-md p-3 mb-4 hidden">
                            <div class="mt-3 text-sm text-gray-600 space-y-2">
                                <p><strong>Langkah 1:</strong> Buat satu Google Sheet baru.</p>
                                <p><strong>Langkah 2:</strong> Di baris pertama (header), anda <strong>MESTI</strong> taip nama lajur (headings) ini *tepat-tepat* seperti di bawah:</p>
                                <code class="block bg-gray-200 p-2 rounded text-xs overflow-x-auto">
                                    IC, Nama Murid, Tempat Lahir, Tarikh Lahir, Jantina, Warganegara, Etnik, Nama Penjaga, Alamat Penjaga, Sekolah, Bahasa Pengantar, Tarikh Masuk, No. Daftar Sekolah, Tarikh Berhenti, Tingkatan Tertinggi, Sebab Berhenti, Peperiksaan Awam, Sekolah Terdahulu, Minat / Kebolehan Khas, Komen Pengetua
                                </code>
                                <p><strong>Langkah 3:</strong> Pergi ke laman web <a href="https://sheetdb.io/" target="_blank" class="text-blue-600 hover:underline">SheetDB.io</a> dan daftar akaun percuma.</p>
                                <p><strong>Langkah 4:</strong> Klik "Create New API". Kongsi Google Sheet anda (gunakan pautan "Anyone with the link can edit") dan tampal pautan Google Sheet anda ke dalam SheetDB.</p>
                                <p><strong>Langkah 5:</strong> SheetDB akan memberi anda satu "API URL". Salin URL itu dan tampal di bawah.</p>
                            </div>
                        </details>
                        
                        <input type="hidden" id="sheetdb-url" value="https://sheetdb.io/api/v1/VJ0QYRSKTFYY0">
                        
                        <div class="mt-4">
                            <button type="button" id="hantar-sheet-btn" class="w-full inline-flex justify-center items-center rounded-md bg-green-600 px-4 py-3 text-base font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009.175 17V5.106l4.8 1.371a1 1 0 001.169-1.409l-7-14z" />
                                </svg>
                                Hantar kepada guru kelas
                            </button>
                        </div>
                        
                        <div id="sheet-status-mesej" class="mt-3 text-sm font-medium text-green-700 hidden"></div>
                    </div>
                    </form>
            </div>

            </div>
    </div>

    <script type="module">
        // Pastikan DOM dimuat sepenuhnya sebelum menjalankan skrip
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Logik Auto-fill IC ---
            const icInput = document.getElementById('no-ic');
            const tarikhLahirInput = document.getElementById('tarikh-lahir');
            // Betulkan ID untuk jantina, ia kini 'jantina' (input teks)
            const jantinaInput = document.getElementById('jantina'); // Betulkan pembolehubah

            icInput.addEventListener('input', (e) => {
                let ic = e.target.value.replace(/\D/g, ''); // Buang bukan digit
                if (ic.length > 12) {
                    ic = ic.substring(0, 12);
                }
                e.target.value = ic;

                if (ic.length === 12) {
                    // Ekstrak tarikh lahir (YYMMDD)
                    const tahun = ic.substring(0, 2);
                    const bulan = ic.substring(2, 4);
                    const hari = ic.substring(4, 6);
                    
                    // Tentukan abad (2000+ jika 00-sekarang, 1900+ jika > sekarang)
                    const tahunSemasa = new Date().getFullYear() % 100;
                    // Tentukan abad (cth: 05 -> 2005, 98 -> 1998)
                    const abad = (parseInt(tahun, 10) <= (tahunSemasa + 1)) ? '20' : '19';
                    
                    // Pastikan tarikhLahirInput wujud sebelum menggunakannya
                    if (tarikhLahirInput) {
                        tarikhLahirInput.value = `${abad}${tahun}-${bulan}-${hari}`;
                    }

                    // Ekstrak jantina (digit akhir)
                    const jantinaDigit = parseInt(ic.charAt(11), 10);
                    // Pastikan jantinaInput wujud
                    if (jantinaInput) {
                        jantinaInput.value = (jantinaDigit % 2 === 0) ? 'PEREMPUAN' : 'LELAKI';
                        // Paksa uppercase untuk Jantina juga
                        jantinaInput.value = jantinaInput.value.toUpperCase();
                    }
                } else {
                    // Kosongkan jika IC tidak lengkap
                    if (tarikhLahirInput) {
                        tarikhLahirInput.value = '';
                    }
                    if (jantinaInput) {
                        jantinaInput.value = '';
                    }
                }
            });

            // --- Logik Force Uppercase ---
            const forceUppercase = (e) => {
                // Jangan paksa uppercase untuk IC
                if (e.target.id === 'no-ic') {
                    return;
                }

                // Simpan kedudukan kursor
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                
                // Tukar nilai ke uppercase
                e.target.value = e.target.value.toUpperCase();
                
                // Letakkan kursor kembali ke tempat asal
                e.target.setSelectionRange(start, end);
            };

            // Pilih semua input teks dan textarea
            const textInputs = document.querySelectorAll(
                'input[type="text"], textarea'
            );
            
            // Tambah event listener 'input' pada setiap satu
            textInputs.forEach((input) => {
                input.addEventListener('input', forceUppercase);
            });


            // --- Logik Komen Rawak ---
            // const komenButton = document.getElementById('generate-komen'); // Dibuang
            const komenTextarea = document.getElementById('komen-pengetua');
            const komenList = [
                "PELAJAR MENUNJUKKAN DISIPLIN YANG BAIK DAN MEMBERI KERJASAMA DALAM SEMUA AKTIVITI SEKOLAH.",
                "SEORANG PELAJAR YANG BERPOTENSI DAN BERKEUPAYAAN TINGGI DALAM AKADEMIK SERTA KOKURIKULUM.",
                "PELAJAR INI BERAKHLAK BAIK, BERDISIPLIN DAN MENUNJUKKAN SIKAP POSITIF TERHADAP PEMBELAJARAN.",
                "MEMILIKI SEMANGAT BELAJAR YANG BAIK DAN SENTIASA BERUSAHA MENINGKATKAN PENCAPAIAN DIRI.",
                "PELAJAR MENUNJUKKAN PERKEMBANGAN YANG MEMUASKAN DAN SENTIASA MENGHORMATI GURU SERTA RAKAN."
            ];
            
            // Jana komen secara automatik semasa halaman dibuka
            if(komenTextarea) { // Tambah semakan jika elemen wujud
                const randomIndex = Math.floor(Math.random() * komenList.length);
                komenTextarea.value = komenList[randomIndex];
            }

            // Listener butang telah dibuang
            // komenButton.addEventListener('click', () => { ... });

            // --- Logik Pilihan Minat (Checkboxes) ---
            const minatContainer = document.getElementById('minat-options-container');
            // Tambah semakan null di sini, walaupun HTML sudah dibetulkan
            if (minatContainer) { 
                const minatCheckboxes = minatContainer.querySelectorAll('input[name="minat-checkbox"]');
                const minatTextarea = document.getElementById('minat-khas');
                const minatError = document.getElementById('minat-error');
                const lainCheckbox = document.getElementById('minat-lain-checkbox');
                const lainText = document.getElementById('minat-lain-text');
                const MAX_MINAT = 3;

                // Fungsi berasingan untuk mengemas kini textarea minat
                const updateMinatTextarea = () => {
                    if (!minatTextarea) return; // Tambah semakan
                    const finalCheckedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    const selectedValues = finalCheckedBoxes.map(cb => {
                        if (cb.id === 'minat-lain-checkbox' && lainText) {
                            // Jika 'Lain-lain' ditanda, ambil nilai dari kotak teks
                            return lainText.value; // (forceUppercase sudah uruskan uppercase)
                        } else {
                            // Jika tidak, ambil nilai dari checkbox
                            return cb.value;
                        }
                    });
                    
                    minatTextarea.value = selectedValues
                        .filter(val => val && val.trim() !== '') // Buang nilai kosong
                        .join(', ');
                };

                minatContainer.addEventListener('change', (e) => {
                    // Hanya bertindak jika ia checkbox
                    if (e.target.name !== 'minat-checkbox') return;

                    // Logik untuk enable/disable kotak teks "Lain-lain"
                    if (e.target.id === 'minat-lain-checkbox' && lainText) {
                        lainText.disabled = !e.target.checked;
                        if (!e.target.checked) {
                            lainText.value = ''; // Kosongkan bila uncheck
                        }
                    }

                    // Kira berapa banyak yang ditanda
                    const checkedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    
                    if (checkedBoxes.length > MAX_MINAT) {
                        // Jika lebih 3, batalkan tanda yang baru
                        e.target.checked = false; 
                        // Jika yang dibatalkan ialah 'Lain-lain', disable kotak teksnya
                        if (e.target.id === 'minat-lain-checkbox' && lainText) {
                            lainText.disabled = true;
                            lainText.value = '';
                        }
                        if(minatError) minatError.classList.remove('hidden'); // Tunjuk amaran
                        // Sembunyikan amaran selepas 2 saat
                        setTimeout(() => {
                            if(minatError) minatError.classList.add('hidden');
                        }, 2000);
                    } else {
                        if(minatError) minatError.classList.add('hidden'); // Sembunyi amaran
                    }
                    
                    // Kemas kini textarea
                    updateMinatTextarea(); // Guna fungsi baru

                    // Logik untuk disable/enable baki checkbox
                    const finalCheckedBoxes = Array.from(minatCheckboxes).filter(cb => cb.checked);
                    if (finalCheckedBoxes.length >= MAX_MINAT) {
                        minatCheckboxes.forEach(cb => {
                            if (!cb.checked) {
                                cb.disabled = true; // Matikan yang tidak ditanda
                            }
                        });
                    } else {
                        minatCheckboxes.forEach(cb => {
                            cb.disabled = false; // Aktifkan semua
                        });
                    }
                });

                // Listener baru untuk kotak teks "Lain-lain"
                // Kemas kini textarea utama apabila menaip di "Lain-lain"
                if(lainText) {
                    lainText.addEventListener('input', () => {
                        // forceUppercase akan handle uppercase secara automatik
                        updateMinatTextarea(); 
                    });
                }
            } // Tutup semakan 'if (minatContainer)'


            // === LOGIK BARU UNTUK HANTAR KE GOOGLE SHEET ===
            
            const sheetdbUrlInput = document.getElementById('sheetdb-url');
            const hantarSheetBtn = document.getElementById('hantar-sheet-btn');
            const sheetStatusMesej = document.getElementById('sheet-status-mesej');

            // Fungsi untuk tunjuk mesej status
            const tunjukMesejSheet = (mesej, jenis = 'berjaya') => {
                if (!sheetStatusMesej) return;
                sheetStatusMesej.innerText = mesej;
                sheetStatusMesej.classList.remove('hidden', 'text-green-700', 'text-red-700');
                sheetStatusMesej.classList.add(jenis === 'berjaya' ? 'text-green-700' : 'text-red-700');

                // Sembunyikan mesej selepas 5 saat
                setTimeout(() => {
                    sheetStatusMesej.classList.add('hidden');
                }, 5000);
            };
            
            // Helper untuk dapatkan nilai, pulangkan '' jika null
            const getValue = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : '';
            };

            // Fungsi untuk kumpul semua data dari borang sebagai JSON
            const kumpulMaklumatJson = () => {
                // Nama kunci (cth: 'IC') mesti TEPAT SAMA dengan tajuk lajur di Google Sheet
                return {
                    'IC': getValue('no-ic'),
                    'Nama Murid': getValue('nama-murid'),
                    'Tempat Lahir': getValue('tempat-lahir'),
                    'Tarikh Lahir': getValue('tarikh-lahir'),
                    'Jantina': getValue('jantina'),
                    'Warganegara': getValue('warganegara'),
                    'Etnik': getValue('kumpulan-etnik'),
                    'Nama Penjaga': getValue('nama-penjaga'),
                    'Alamat Penjaga': getValue('alamat-penjaga'),
                    'Sekolah': getValue('sekolah'),
                    'Bahasa Pengantar': getValue('bahasa-pengantar'),
                    'Tarikh Masuk': getValue('tarikh-masuk'),
                    'No. Daftar Sekolah': getValue('no-daftar-sekolah'),
                    'Tarikh Berhenti': getValue('tarikh-berhenti'),
                    'Tingkatan Tertinggi': getValue('tingkatan-tertinggi'),
                    'Sebab Berhenti': getValue('sebab-berhenti'),
                    'Peperiksaan Awam': getValue('peperiksaan-awam'),
                    'Sekolah Terdahulu': getValue('sekolah-terdahulu'),
                    'Minat / Kebolehan Khas': getValue('minat-khas'),
                    'Komen Pengetua': getValue('komen-pengetua')
                };
            };

            // Senarai medan yang WAJIB diisi [id, Nama Mesra]
            const medanWajib = [
                ['no-ic', 'Nombor IC'],
                ['nama-murid', 'Nama Murid'],
                ['tempat-lahir', 'Tempat Lahir'],
                ['tarikh-lahir', 'Tarikh Lahir (automatik dari IC)'],
                ['jantina', 'Jantina (automatik dari IC)'],
                ['warganegara', 'Warganegara'],
                ['kumpulan-etnik', 'Kumpulan Etnik'],
                ['nama-penjaga', 'Nama Penjaga'],
                ['alamat-penjaga', 'Alamat Penjaga'],
                ['sekolah', 'Sekolah'],
                ['bahasa-pengantar', 'Bahasa Pengantar'],
                ['tarikh-masuk', 'Tarikh Masuk'],
                ['no-daftar-sekolah', 'No. Daftar Sekolah'],
                ['tarikh-berhenti', 'Tarikh Berhenti'],
                ['tingkatan-tertinggi', 'Tingkatan Tertinggi'],
                ['sebab-berhenti', 'Sebab Berhenti'],
                ['peperiksaan-awam', 'Peperiksaan Awam'],
                ['sekolah-terdahulu', 'Sekolah Terdahulu'],
                ['minat-khas', 'Minat / Kebolehan Khas (sila pilih)'],
                ['komen-pengetua', 'Komen Pengetua (automatik)'] // Kemas kini nama mesra
            ];

            // Tambah listener pada butang Hantar
            if(hantarSheetBtn) {
                hantarSheetBtn.addEventListener('click', () => {

                    // --- VALIDASI BARU ---
                    let medanPertamaKosong = null;
                    for (const [id, nama] of medanWajib) {
                        const medan = document.getElementById(id);
                        // Semak jika medan wujud dan jika ia kosong
                        if (!medan || !medan.value || medan.value.trim() === '') {
                            medanPertamaKosong = nama;
                            if (medan) {
                                medan.focus(); // Fokus pada medan yang kosong jika ia wujud
                            } else {
                                console.error(`Medan wajib hilang: ${id}`); // Log ralat jika medan tidak wujud
                            }
                            break; // Berhenti pada ralat pertama
                        }
                    }

                    if (medanPertamaKosong) {
                        tunjukMesejSheet(`Sila isi medan "${medanPertamaKosong}" terlebih dahulu.`, 'gagal');
                        return; // Hentikan proses hantar
                    }
                    // --- TAMAT VALIDASI BARU ---

                    const apiUrl = sheetdbUrlInput.value;
                    
                    if (!apiUrl || !apiUrl.startsWith('https://sheetdb.io/api/v1/')) {
                        tunjukMesejSheet("URL API SheetDB tidak sah. Sila semak semula.", 'gagal');
                        return;
                    }

                    const data = kumpulMaklumatJson();
                    
                    // Tunjuk status & disable butang
                    tunjukMesejSheet("Menghantar data...", 'berjaya');
                    hantarSheetBtn.disabled = true;

                    // Hantar data ke SheetDB
                    fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            data: data // Hantar sebagai satu baris
                        })
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.created) {
                            tunjukMesejSheet(`Berjaya! ${result.created} baris telah ditambah ke Google Sheet.`);
                            // Anda boleh kosongkan borang jika mahu
                            // document.getElementById('sijil-form').reset();
                        } else {
                            console.error('Ralat SheetDB:', result);
                            tunjukMesejSheet("Gagal dihantar. Semak Konsol (F12) untuk ralat.", 'gagal');
                        }
                    })
                    .catch(error => {
                        console.error('Ralat Fetch:', error);
                        tunjukMesejSheet("Ralat berlaku. Sila periksa URL API dan sambungan internet anda.", 'gagal');
                    })
                    .finally(() => {
                        // Aktifkan semula butang
                        hantarSheetBtn.disabled = false;
                    });
                });
            } // Tutup semakan 'if (hantarSheetBtn)'

        }); // Tutup DOMContentLoaded
    </script>
</body>
</html>
