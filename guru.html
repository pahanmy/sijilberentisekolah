<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Semakan Guru</title>
    <!-- Muat naik Tailwind CSS untuk penggayaan -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan fon Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Animasi 'spin' untuk ikon 'loading' */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 1.5s linear infinite;
        }
        /* Styling untuk Modal */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-body-scroll {
            max-height: 85vh; /* Hadkan ketinggian modal agar boleh discroll */
            overflow-y: auto;
        }
        /* Style untuk jadual modal */
        .modal-table th, .modal-table td {
            padding: 10px 8px; /* Lebih padding */
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem; /* text-sm */
        }
        .modal-table thead th {
            font-weight: 700; /* Bold */
            background-color: #eef2ff; /* Indigo-50 */
            color: #3730a3; /* Indigo-800 */
        }
        /* Penyesuaian Radio Button */
        .custom-radio {
            appearance: none;
            width: 1rem;
            height: 1rem;
            border: 2px solid #9ca3af; /* Gray-400 */
            border-radius: 50%;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }
        .custom-radio:checked {
            border-color: #4f46e5; /* Indigo-600 */
            background-color: #4f46e5;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #4f46e5;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 text-gray-800">

    <!-- Lebar maksimum 6xl untuk memuatkan jadual -->
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">Halaman Semakan Guru</h1>
        <p class="text-center text-gray-600 mb-8">
            Semak data murid yang telah dihantar ke Google Sheet.
        </p>

        <!-- Kontena untuk Butang Muat Semula dan Status -->
        <div class="flex justify-between items-center mb-4">
            <button type="button" id="muat-data-btn" class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition duration-150 ease-in-out">
                <!-- Ikon 'Refresh' -->
                <svg id="muat-ikon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101A7.002 7.002 0 0112.001 4c3.865 0 7 3.134 7 7s-3.135 7-7 7-7-3.134-7-7c0-1.554.506-3.018 1.39-4.215l1.415 1.414A4.982 4.982 0 007.001 11c0 2.757 2.243 5 5 5s5-2.243 5-5-2.243-5-5-5a4.984 4.984 0 00-4.23 2.508l2.13.001a1 1 0 010 2H4.001a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                <span id="muat-teks">Muat Semula Data</span>
            </button>
            <div id="status-mesej" class="text-sm font-medium text-gray-600"></div>
        </div>

        <!-- Kontena Jadual dengan 'overflow' untuk responsif -->
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bil.</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Murid</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. IC</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tingkatan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tindakan</th>
                        </tr>
                    </thead>
                    <tbody id="jadual-murid" class="bg-white divide-y divide-gray-200">
                        <!-- Data murid akan dimasukkan oleh JavaScript di sini -->
                        <tr>
                            <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                                Sila tekan butang "Muat Semula Data" untuk memaparkan maklumat.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <p class="text-xs text-gray-500 text-center mt-4">
            Nota: Pautan butang "Tindakan" di bawah adalah contoh.
        </p>

    </div>

    <!-- === MODAL SIJIL PENCAPAIAN KHAS (BARU) === -->
    <div id="sijil-khas-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden modal-overlay">
        <!-- Modal Content (Lebar lebih besar untuk borang) -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl modal-body-scroll">
            <div class="p-6 sm:p-8">
                <h3 class="text-2xl font-bold text-indigo-700 border-b border-indigo-200 pb-3 mb-4">Pengisian Sijil Pencapaian Khas</h3>
                
                <form id="sijil-khas-form" class="mt-4 space-y-6">
                    <!-- Maklumat Asas Murid -->
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50/50 space-y-1">
                        <p class="text-sm font-medium">Nama Murid: <span id="sijil-khas-modal-nama-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">No. K/P: <span id="sijil-khas-modal-ic-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Kelas/Tingkatan: <span id="sijil-khas-modal-tingkatan" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Tahun: <span id="sijil-khas-modal-tahun" class="font-semibold text-indigo-800"></span></p>
                        <!-- Maklumat penting yang disembunyikan untuk proses penghantaran data -->
                        <input type="hidden" id="sijil-khas-modal-ic-hidden"> 
                    </div>

                    <!-- Bahagian 1: Program Anugerah Skim Lencana Bintang -->
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">Program Anugerah Skim Lencana Bintang</h4>
                    <div class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Cemerlang" class="custom-radio" checked>
                                <span class="text-sm">Cemerlang (7 Bintang - merit ke atas)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Baik" class="custom-radio">
                                <span class="text-sm">Baik (3-4 Bintang - 840-1919 mata merit)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan (1-2 Bintang - 240-839 mata merit)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Kurang Memuaskan" class="custom-radio">
                                <span class="text-sm">Kurang Memuaskan (Kurang daripada 240 mata merit)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Bahagian 2: Program Nilam (Nadi Ilmu Amalan Membaca) -->
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">Program Nilam (Nadi Ilmu Amalan Membaca)</h4>
                    <div class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="5 Bintang" class="custom-radio" checked>
                                <span class="text-sm">5 Bintang (600+ bahan bacaan ke atas)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="4 Bintang" class="custom-radio">
                                <span class="text-sm">4 Bintang (480-599 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="3 Bintang" class="custom-radio">
                                <span class="text-sm">3 Bintang (360-479 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="2 Bintang" class="custom-radio">
                                <span class="text-sm">2 Bintang (240-359 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="1 Bintang" class="custom-radio">
                                <span class="text-sm">1 Bintang (120-239 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="Tidak Mencapai" class="custom-radio">
                                <span class="text-sm">Tidak mencapai tahap (Kurang daripada 120 bahan bacaan)</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Bahagian 3: Prestasi Kehadiran Sekolah -->
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">Prestasi Kehadiran Sekolah</h4>
                    <div class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir" value="Cemerlang" class="custom-radio" checked>
                                <span class="text-sm">Cemerlang (98-100%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir" value="Baik" class="custom-radio">
                                <span class="text-sm">Baik (90-97%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan (85-89%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir" value="Kurang Memuaskan" class="custom-radio">
                                <span class="text-sm">Kurang Memuaskan (Kurang daripada 85%)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Butang Aksi -->
                    <div class="pt-4 flex justify-end space-x-3 border-t border-gray-200">
                        <button type="button" id="tutup-sijil-khas-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition duration-150 ease-in-out">
                            Tutup
                        </button>
                        <button type="submit" id="simpan-sijil-khas-btn" class="rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 transition duration-150 ease-in-out">
                            Simpan Data & Jana Sijil
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- === TAMAT MODAL SIJIL PENCAPAIAN KHAS === -->


    <!-- === MODAL SURAT AKUAN (SEBELUM INI) === -->
    <div id="surat-akuan-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden modal-overlay">
        <!-- Modal Content (Lebar lebih besar untuk borang) -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl modal-body-scroll">
            <div class="p-6 sm:p-8">
                <h3 class="text-2xl font-bold text-indigo-700 border-b border-indigo-200 pb-3 mb-4">Pengisian Surat Akuan Sekolah</h3>
                
                <form id="surat-akuan-form" class="mt-4 space-y-6">
                    <!-- Maklumat Asas Murid -->
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50/50 space-y-1">
                        <p class="text-sm font-medium">Nama Murid: <span id="modal-nama-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">No. K/P: <span id="modal-ic-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Tempoh Sekolah: <span id="modal-tempoh-sekolah" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Tingkatan Tertinggi: <span id="modal-tingkatan" class="font-semibold text-indigo-800"></span></p>
                        <!-- Maklumat penting yang disembunyikan untuk proses penghantaran data -->
                        <input type="hidden" id="modal-ic-hidden"> 
                        <input type="hidden" id="modal-tarikh-masuk">
                        <input type="hidden" id="modal-tarikh-berhenti">
                    </div>

                    <!-- Bahagian A: Prestasi Akademik (Tukar ke Radio Button) -->
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">A. Prestasi Akademik</h4>
                    <div class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <label class="text-sm font-medium text-gray-700">Pencapaian:</label>
                        <div class="flex items-center space-x-4">
                            <!-- Butang Cemerlang -->
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Cemerlang" class="custom-radio">
                                <span class="text-sm">Cemerlang</span>
                            </label>
                            <!-- Butang Baik (Default) -->
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Baik" class="custom-radio" checked>
                                <span class="text-sm">Baik</span>
                            </label>
                            <!-- Butang Memuaskan -->
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan</span>
                            </label>
                            <!-- Butang Tidak Memuaskan -->
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Tidak Memuaskan" class="custom-radio">
                                <span class="text-sm">Tidak Memuaskan</span>
                            </label>
                        </div>
                    </div>


                    <!-- Bahagian B: Kualiti Peribadi (Gred Radio Buttons, Default Baik) -->
                    <h4 class="text-lg font-semibold text-gray-800">B. Kualiti Peribadi</h4>
                    <div class="overflow-x-auto border rounded-lg shadow-sm">
                        <table class="min-w-full modal-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="w-1/3">Kualiti</th>
                                    <th class="text-center">Cemerlang</th>
                                    <th class="text-center">Baik</th>
                                    <th class="text-center">Memuaskan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data Kualiti Peribadi (Semua ditetapkan kepada Baik) -->
                                <tr id="row-bertanggungjawab">
                                    <td>i) Bertanggungjawab</td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-dayausaha">
                                    <td>ii) Daya usaha</td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-jujur">
                                    <td>iii) Jujur</td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-keyakinan">
                                    <td>iv) Keyakinan diri</td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-kepimpinan">
                                    <td>v) Kepimpinan</td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-kesopanan">
                                    <td>vi) Kesopanan</td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-disiplin">
                                    <td>vii) Disiplin</td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Bahagian C: Tugas Khas / Jawatan Khas (Checkbox) -->
                    <h4 class="text-lg font-semibold text-gray-800">C. Tugas Khas / Jawatan Khas (Pilih yang berkaitan)</h4>
                    <div class="overflow-x-auto border rounded-lg shadow-sm">
                        <table class="min-w-full modal-table">
                            <thead>
                                <tr>
                                    <th class="w-1/3">Tugas Khas</th>
                                    <th class="text-center">Ketua</th>
                                    <th class="text-center">Penolong Ketua/Setiausaha/Bendahari/Ketua Biro</th>
                                    <th class="text-center">Ahli Jawatankuasa</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data Tugas Khas -->
                                <tr id="jaw-1">
                                    <td>1. Pengawas Sekolah</td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-2">
                                    <td>2. Pengawas Tingkatan</td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-3">
                                    <td>3. Pengawas Asrama</td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-4">
                                    <td>4. Pengawas Kelas</td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-5">
                                    <td>5. Pengawas Perpustakaan</td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-6">
                                    <td>6. Lain-lain (Nyatakan)</td>
                                    <td colspan="3"><input type="text" id="jaw-lain" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Bahagian D: Kehadiran -->
                    <h4 class="text-lg font-semibold text-gray-800">D. Kehadiran Sekolah</h4>
                    <div class="flex items-center space-x-4">
                        <label for="peratus-hadir" class="text-sm font-medium text-gray-700">Peratus Kehadiran (%):</label>
                        <input type="number" id="peratus-hadir" value="100" min="0" max="100" class="w-20 rounded-md border-gray-300 shadow-sm text-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    
                    <!-- Bahagian E: Catatan -->
                    <h4 class="text-lg font-semibold text-gray-800">E. Catatan</h4>
                    <div>
                        <textarea id="catatan-tambahan" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>

                    <!-- Input tersembunyi untuk menyimpan URL API guru (untuk simpan penilaian) -->
                    <input type="hidden" id="sheetdb-url-guru" value="https://sheetdb.io/api/v1/ox3yu9lw1ua8g"> <!-- TELAH DIKEMASKINI DENGAN URL BARU -->

                    <!-- Butang Aksi -->
                    <div class="pt-4 flex justify-end space-x-3 border-t border-gray-200">
                        <button type="button" id="tutup-modal-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition duration-150 ease-in-out">
                            Tutup
                        </button>
                        <button type="button" id="simpan-data-btn" class="rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 transition duration-150 ease-in-out">
                            Simpan Data Penilaian
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- === TAMAT MODAL SURAT AKUAN === -->
    
    <!-- === MODAL PENGESAHAN SIMPAN GURU === -->
    <div id="confirm-simpan-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold text-gray-900">Sahkan Penyimpanan Data</h3>
            <p class="mt-2 text-sm text-gray-600">Anda pasti ingin menyimpan dan mengemaskini maklumat penilaian Surat Akuan ini?</p>
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="batal-simpan-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    Batal
                </button>
                <button type="button" id="teruskan-simpan-btn" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    Ya, Simpan
                </button>
            </div>
        </div>
    </div>
    <!-- === TAMAT MODAL PENGESAHAN SIMPAN GURU === -->


    <!-- Skrip JavaScript untuk memuat data dari SheetDB -->
    <script type="module">
        // URL API SheetDB untuk data murid (sumber data jadual)
        const sheetDBUrlMurid = "https://sheetdb.io/api/v1/VJ0QYRSKTFYY0"; 
        // Pembolehubah untuk menyimpan semua data murid yang dimuatkan
        let dataMuridGlobal = []; 

        // Dapatkan elemen DOM
        const muatDataBtn = document.getElementById('muat-data-btn');
        const muatIkon = document.getElementById('muat-ikon');
        const muatTeks = document.getElementById('muat-teks');
        const jadualBody = document.getElementById('jadual-murid');
        const statusMesej = document.getElementById('status-mesej');
        
        // Elemen Modal
        const suratAkuanModal = document.getElementById('surat-akuan-modal');
        const sijilKhasModal = document.getElementById('sijil-khas-modal');
        const tutupModalBtn = document.getElementById('tutup-modal-btn');
        const tutupSijilKhasBtn = document.getElementById('tutup-sijil-khas-btn');
        
        // Elemen Borang & Butang Simpan
        const simpanDataBtn = document.getElementById('simpan-data-btn');
        const suratAkuanForm = document.getElementById('surat-akuan-form');
        const sijilKhasForm = document.getElementById('sijil-khas-form');

        // Elemen Modal Pengesahan Simpan
        const confirmSimpanModal = document.getElementById('confirm-simpan-modal');
        const batalSimpanBtn = document.getElementById('batal-simpan-btn');
        const teruskanSimpanBtn = document.getElementById('teruskan-simpan-btn');
        
        // Tutup modal Surat Akuan bila butang 'Tutup' diklik
        if (tutupModalBtn) {
            tutupModalBtn.addEventListener('click', () => {
                suratAkuanModal.classList.add('hidden');
            });
        }
        // Tutup modal Sijil Khas bila butang 'Tutup' diklik
        if (tutupSijilKhasBtn) {
            tutupSijilKhasBtn.addEventListener('click', () => {
                sijilKhasModal.classList.add('hidden');
            });
        }
        
        // Tutup modal bila overlay diklik (untuk kedua-dua modal)
        [suratAkuanModal, sijilKhasModal].forEach(modal => {
            if (modal) {
                modal.addEventListener('click', (e) => {
                    const modalContent = modal.querySelector('.bg-white');
                    if (modalContent && !modalContent.contains(e.target)) {
                        modal.classList.add('hidden');
                    }
                });
            }
        });


        // Fungsi untuk format tarikh (YYYY-MM-DD -> DD/MM/YYYY)
        const formatTarikh = (tarikhStr) => {
            if (!tarikhStr) return '';
            const [tahun, bulan, hari] = tarikhStr.split('-');
            if (tahun && bulan && hari) {
                // Format kepada DD/MM/YYYY (gaya yang biasa digunakan dalam dokumen)
                return `${hari}/${bulan}/${tahun}`;
            }
            return tarikhStr; // Pulangkan asal jika format salah
        };
        
        // Fungsi untuk paparkan mesej status sementara di dalam jadual guru
        const tunjukStatusGuru = (mesej, jenis = 'info') => {
            if (!statusMesej) return;
            statusMesej.innerText = mesej;
            statusMesej.classList.remove('text-red-600', 'text-green-700', 'text-gray-600');
            if (jenis === 'gagal') {
                statusMesej.classList.add('text-red-600');
            } else if (jenis === 'berjaya') {
                statusMesej.classList.add('text-green-700');
            } else {
                statusMesej.classList.add('text-gray-600');
            }

            // Sembunyikan selepas 5 saat jika bukan loading
            if (jenis !== 'loading') {
                setTimeout(() => {
                    statusMesej.innerText = 'Sedia.';
                    statusMesej.classList.remove('text-red-600', 'text-green-700');
                    statusMesej.classList.add('text-gray-600');
                }, 5000);
            }
        };
        
        const tutupModal = (modalElement) => {
            if (modalElement) modalElement.classList.add('hidden');
        }

        // Fungsi untuk memaparkan modal Surat Akuan
        window.paparModalSuratAkuan = (index) => {
            const murid = dataMuridGlobal[index];
            if (!murid) {
                console.error("Data murid tidak ditemui.");
                return;
            }

            // ... (Logik pengisian modal Surat Akuan) ...

            // Dapatkan elemen dalam modal
            document.getElementById('modal-nama-murid').innerText = murid['Nama Murid'] || 'N/A';
            document.getElementById('modal-ic-murid').innerText = murid['IC'] || 'N/A';
            document.getElementById('modal-tingkatan').innerText = murid['Tingkatan Tertinggi'] || 'N/A';
            
            const tarikhMasuk = formatTarikh(murid['Tarikh Masuk']);
            const tarikhBerhenti = formatTarikh(murid['Tarikh Berhenti']);

            // Simpan maklumat penting dalam hidden field untuk proses penghantaran
            document.getElementById('modal-ic-hidden').value = murid['IC'] || '';
            document.getElementById('modal-tarikh-masuk').value = murid['Tarikh Masuk'] || '';
            document.getElementById('modal-tarikh-berhenti').value = murid['Tarikh Berhenti'] || '';

            // Paparkan tempoh sekolah (Contoh: 20/01/2021 hingga 19/12/2025)
            document.getElementById('modal-tempoh-sekolah').innerText = `${tarikhMasuk} hingga ${tarikhBerhenti}`;

            // Reset borang gred/jawatan setiap kali modal dibuka (Ini juga menetapkan lalai 'Baik' semula)
            document.getElementById('surat-akuan-form').reset();
            
            // Set lalai untuk Prestasi Akademik kepada 'Baik'
            const prestasiAkademikRadios = document.querySelectorAll('input[name="prestasi-akademik"]');
            prestasiAkademikRadios.forEach(radio => {
                if (radio.value === 'Baik') {
                    radio.checked = true;
                }
            });

            // Tunjukkan modal
            suratAkuanModal.classList.remove('hidden');
        };

        // Fungsi untuk memaparkan modal Sijil Pencapaian Khas (BARU)
        window.paparModalSijilKhas = (index) => {
            const murid = dataMuridGlobal[index];
            if (!murid) {
                console.error("Data murid tidak ditemui.");
                return;
            }

            // Dapatkan elemen dalam modal
            document.getElementById('sijil-khas-modal-nama-murid').innerText = murid['Nama Murid'] || 'N/A';
            document.getElementById('sijil-khas-modal-ic-murid').innerText = murid['IC'] || 'N/A';
            document.getElementById('sijil-khas-modal-tingkatan').innerText = murid['Tingkatan Tertinggi'] || 'N/A';
            
            // Tentukan tahun semasa (untuk Sijil Khas)
            const tahunSemasa = new Date().getFullYear();
            document.getElementById('sijil-khas-modal-tahun').innerText = tahunSemasa;

            // Simpan IC dalam hidden field
            document.getElementById('sijil-khas-modal-ic-hidden').value = murid['IC'] || '';

            // Reset borang
            document.getElementById('sijil-khas-form').reset();

            // Tetapkan lalai (Cemerlang/5 Bintang/Cemerlang)
            document.querySelector('input[name="lencana-bintang"][value="Cemerlang"]').checked = true;
            document.querySelector('input[name="program-nilam"][value="5 Bintang"]').checked = true;
            document.querySelector('input[name="prestasi-hadir"][value="Cemerlang"]').checked = true;

            // Tunjukkan modal Sijil Khas
            sijilKhasModal.classList.remove('hidden');
        };


        // Fungsi utama untuk mengumpul, menyimpan data, dan menjana surat (pencetakan)
        const lakukanSimpanData = async (formType) => {
            
            const isSijilKhas = formType === 'SijilKhas';
            const apiUrl = document.getElementById('sheetdb-url-guru').value;

            // Kumpulan data
            const getRadioValue = (name) => {
                const form = isSijilKhas ? sijilKhasForm : suratAkuanForm;
                const radioChecked = form.querySelector(`input[name="${name}"]:checked`);
                return radioChecked ? radioChecked.value : '';
            };
            
            let dataHantar = {};
            let simpanBtnText = '';
            
            if (isSijilKhas) {
                simpanBtnText = "Simpan Data & Jana Sijil";
                dataHantar = {
                    'IC': document.getElementById('sijil-khas-modal-ic-hidden').value,
                    'Nama Murid': document.getElementById('sijil-khas-modal-nama-murid').innerText,
                    'Tingkatan': document.getElementById('sijil-khas-modal-tingkatan').innerText,
                    'Tahun': document.getElementById('sijil-khas-modal-tahun').innerText,
                    
                    'Lencana Bintang': getRadioValue('lencana-bintang'),
                    'Program Nilam': getRadioValue('program-nilam'),
                    'Prestasi Kehadiran Sijil Khas': getRadioValue('prestasi-hadir'),
                    
                    // Tambah medan lain yang mungkin diperlukan untuk Sijil Khas
                    'Jenis Dokumen': 'Sijil Khas'
                };
            } else { // Surat Akuan
                simpanBtnText = "Simpan Data Penilaian";
                const kualitiPeribadiValues = [];
                for (let i = 1; i <= 7; i++) kualitiPeribadiValues.push(getRadioValue(`gred-${i}`));
                
                const jawatanKhasValues = [];
                for (let i = 1; i <= 5; i++) jawatanKhasValues.push(getRadioValue(`jaw-${i}`));

                dataHantar = {
                    'IC': document.getElementById('modal-ic-hidden').value,
                    'Nama Murid': document.getElementById('modal-nama-murid').innerText,
                    'Tingkatan': document.getElementById('modal-tingkatan').innerText,
                    'Tarikh Masuk': document.getElementById('modal-tarikh-masuk').value,
                    'Tarikh Berhenti': document.getElementById('modal-tarikh-berhenti').value,
                    'Akademik': getRadioValue('prestasi-akademik'),
                    
                    'Bertanggungjawab': kualitiPeribadiValues[0], 'Daya Usaha': kualitiPeribadiValues[1],
                    'Jujur': kualitiPeribadiValues[2], 'Keyakinan Diri': kualitiPeribadiValues[3],
                    'Kepimpinan': kualitiPeribadiValues[4], 'Kesopanan': kualitiPeribadiValues[5],
                    'Disiplin': kualitiPeribadiValues[6],

                    'Jawatan 1': jawatanKhasValues[0], 'Jawatan 2': jawatanKhasValues[1],
                    'Jawatan 3': jawatanKhasValues[2], 'Jawatan 4': jawatanKhasValues[3],
                    'Jawatan 5': jawatanKhasValues[4], 
                    'Jawatan Khas Lain': document.getElementById('jaw-lain').value,

                    'Peratus Kehadiran': document.getElementById('peratus-hadir').value,
                    'Catatan': document.getElementById('catatan-tambahan').value,
                    'Jenis Dokumen': 'Surat Akuan'
                };
            }

            // 1. Validasi URL API Guru
            if (!apiUrl || !apiUrl.startsWith('https://sheetdb.io/api/v1/')) {
                alert("RALAT: URL API Penilaian Guru tidak sah. Sila semak semula kod.");
                return false;
            }

            // 2. Lakukan Penghantaran Data ke SheetDB Penilaian Guru
            const currentSimpanBtn = isSijilKhas ? document.getElementById('simpan-sijil-khas-btn') : simpanDataBtn;
            
            currentSimpanBtn.disabled = true;
            currentSimpanBtn.innerText = "Menyimpan...";

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: dataHantar })
                });

                const result = await response.json();

                if (result.created) {
                    // Berjaya disimpan!
                    const modalToClose = isSijilKhas ? sijilKhasModal : suratAkuanModal;
                    tutupModal(modalToClose);
                    tunjukStatusGuru(`Maklumat ${isSijilKhas ? 'Sijil Khas' : 'Penilaian'} Berjaya Disimpan dan Dikemaskini.`, 'berjaya');
                    return true;
                } else {
                    console.error(`Ralat SheetDB (Simpan ${formType}):`, result);
                    tunjukStatusGuru("RALAT: Gagal menyimpan data penilaian. Sila semak konsol.", 'gagal');
                    return false;
                }
            } catch (error) {
                console.error(`Ralat Fetch (Simpan ${formType}):`, error);
                tunjukStatusGuru("RALAT: Ralat sambungan berlaku. Gagal menyimpan data penilaian.", 'gagal');
                return false;
            } finally {
                currentSimpanBtn.disabled = false;
                currentSimpanBtn.innerText = simpanBtnText;
            }
        };

        // --- PENGENDALI ACARA UNTUK SURAT AKUAN (SIMPAN) ---
        // 1. Apabila butang 'Simpan Data Penilaian' diklik (Tunjuk Modal Pengesahan)
        if (simpanDataBtn) {
            simpanDataBtn.addEventListener('click', (e) => {
                e.preventDefault();
                tutupModal(suratAkuanModal); // Sembunyikan modal borang
                confirmSimpanModal.classList.remove('hidden'); // Tunjukkan modal pengesahan
            });
        }
        
        // 2. Apabila butang 'Ya, Simpan' dalam modal pengesahan diklik (Lakukan Penghantaran)
        if (teruskanSimpanBtn) {
            teruskanSimpanBtn.addEventListener('click', () => {
                tutupModal(confirmSimpanModal); // Tutup modal pengesahan
                lakukanSimpanData('SuratAkuan');
            });
        }
        
        // 3. Apabila butang 'Batal' dalam modal pengesahan diklik
        if (batalSimpanBtn) {
            batalSimpanBtn.addEventListener('click', () => {
                tutupModal(confirmSimpanModal); // Tutup modal pengesahan
                suratAkuanModal.classList.remove('hidden'); // Tunjukkan semula modal borang
            });
        }

        // --- PENGENDALI ACARA UNTUK SIJIL KHAS (SIMPAN) ---
        if (sijilKhasForm) {
            sijilKhasForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // Untuk Sijil Khas, kita boleh teruskan simpan tanpa modal pengesahan ringkas
                lakukanSimpanData('SijilKhas');
            });
        }

        
        // Fungsi untuk memuat dan memaparkan data murid (sama seperti sebelumnya)
        const muatDataMurid = async () => {
            // Tunjukkan status 'loading'
            tunjukStatusGuru("Memuatkan data murid...", 'loading');
            muatIkon.classList.add('animate-spin-slow');
            muatTeks.innerText = "Memuatkan...";
            muatDataBtn.disabled = true;

            try {
                const response = await fetch(sheetDBUrlMurid);
                if (!response.ok) {
                    throw new Error(`Ralat Rangkaian: ${response.statusText}`);
                }
                const data = await response.json();
                
                // Simpan data ke pembolehubah global
                dataMuridGlobal = data; 

                // Kosongkan jadual sedia ada
                jadualBody.innerHTML = '';

                if (data.length === 0) {
                    // Paparkan mesej jika tiada data
                    jadualBody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-gray-500">Tiada data murid ditemui.</td></tr>`;
                    tunjukStatusGuru("Tiada data.");
                } else {
                    // Isikan jadual dengan data murid
                    data.forEach((murid, index) => {
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-gray-50 transition duration-150";
                        
                        const icMurid = murid['IC'] || '';
                        
                        tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${murid['Nama Murid'] || 'TIADA NAMA'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${icMurid}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${murid['Tingkatan Tertinggi'] || ''}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                <button type="button" onclick="paparModalSijilKhas(${index})" title="Buka Borang Sijil Pencapaian Khas"
                                   class="inline-flex items-center rounded-md bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                                    Sijil Pencapaian Khas
                                </button>
                                <!-- Butang Surat Akuan yang memanggil fungsi JS -->
                                <button type="button" onclick="paparModalSuratAkuan(${index})" title="Buka Borang Surat Akuan"
                                   class="inline-flex items-center rounded-md bg-green-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                                    Surat Akuan
                                </button>
                            </td>
                        `;
                        jadualBody.appendChild(tr);
                    });
                    tunjukStatusGuru(`Berjaya memuatkan ${data.length} rekod.`);
                }

            } catch (error) {
                console.error('Gagal memuatkan data:', error);
                tunjukStatusGuru("Gagal memuatkan data. Sila semak konsol.", 'gagal');
                jadualBody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-red-500">Ralat: Gagal mendapatkan data dari SheetDB.</td></tr>`;
            } finally {
                // Berhentikan status 'loading'
                muatIkon.classList.remove('animate-spin-slow');
                muatTeks.innerText = "Muat Semula Data";
                muatDataBtn.disabled = false;
            }
        };

        // Tambah 'event listener' pada butang
        muatDataBtn.addEventListener('click', muatDataMurid);
        
        // Muat data secara automatik semasa halaman dibuka
        muatDataMurid();

    </script>
</body>
</html>
