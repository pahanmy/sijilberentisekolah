<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Semakan Guru</title>
    <!-- Muat naik Tailwind CSS untuk penggayaan -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan fon Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Animasi 'spin' untuk ikon 'loading' */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 1.5s linear infinite;
        }
        /* Styling untuk Modal */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-body-scroll {
            max-height: 85vh; /* Hadkan ketinggian modal agar boleh discroll */
            overflow-y: auto;
        }
        /* Style untuk jadual modal */
        .modal-table th, .modal-table td {
            padding: 10px 8px; /* Lebih padding */
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem; /* text-sm */
        }
        .modal-table thead th {
            font-weight: 700; /* Bold */
            background-color: #eef2ff; /* Indigo-50 */
            color: #3730a3; /* Indigo-800 */
        }
        /* Penyesuaian Radio Button */
        .custom-radio {
            appearance: none;
            width: 1rem;
            height: 1rem;
            border: 2px solid #9ca3af; /* Gray-400 */
            border-radius: 50%;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }
        .custom-radio:checked {
            border-color: #4f46e5; /* Indigo-600 */
            background-color: #4f46e5;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #4f46e5;
        }
        /* Style untuk status selesai */
        .status-selesai {
            /* Menjadikan kontena flex untuk ikon dan teks */
            display: flex;
            flex-direction: column; /* Susun menegak */
            align-items: flex-start; /* Jajar ke kiri */
            font-weight: 600;
            color: #10b981; /* Emerald-500 */
            font-size: 0.8rem;
        }
        /* Style untuk baris masa/tarikh */
        .status-time {
            font-size: 0.65rem; /* Saiz lebih kecil */
            font-weight: 400;
            color: #4b5563; /* Gray-600 */
            margin-top: 2px;
        }
        .status-main {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 text-gray-800">

    <!-- Lebar maksimum 6xl untuk memuatkan jadual -->
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">Halaman Semakan Guru</h1>
        <p class="text-center text-gray-600 mb-8">
            Semak data murid yang telah dihantar ke Google Sheet.
        </p>

        <!-- === KOTAK ANALISIS STATUS (BARU) === -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow-md border-b-4 border-indigo-400">
                <p class="text-xs font-medium text-gray-500">Jumlah Murid</p>
                <p id="analisis-jumlah" class="text-2xl font-bold text-indigo-700">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md border-b-4 border-green-400">
                <p class="text-xs font-medium text-gray-500">Selesai Dinilai</p>
                <p id="analisis-selesai" class="text-2xl font-bold text-green-700">0</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md border-b-4 border-red-400">
                <p class="text-xs font-medium text-gray-500">Belum Dinilai</p>
                <p id="analisis-belum" class="text-2xl font-bold text-red-600">0</p>
            </div>
        </div>
        
        <!-- Kontena untuk Butang Muat Semula dan Status -->
        <div class="flex flex-wrap justify-between items-center mb-4 space-y-3 sm:space-y-0">
            
            <button type="button" id="muat-data-btn" class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition duration-150 ease-in-out order-1 w-full sm:w-auto">
                <!-- Ikon 'Refresh' -->
                <svg id="muat-ikon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101A7.002 7.002 0 0112.001 4c3.865 0 7 3.134 7 7s-3.135 7-7 7-7-3.134-7-7c0-1.554.506-3.018 1.39-4.215l1.415 1.414A4.982 4.982 0 007.001 11c0 2.757 2.243 5 5 5s5-2.243 5-5-2.243-5-5-5a4.984 4.984 0 00-4.23 2.508l2.13.001a1 1 0 010 2H4.001a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                <span id="muat-teks">Muat Semula Data</span>
            </button>
            
            <!-- Pautan Sheet & Sijil -->
            <div class="flex items-center space-x-2 order-3 sm:order-2 w-full sm:w-auto justify-center sm:justify-start">
                
                <!-- Pautan BARU: Halaman Cetak Surat Akuan (ke cetak_akuan_list.html) -->
                <a href="cetak_akuan_list.html" target="_blank" title="Cetak Surat Akuan & Sijil Khas" class="inline-flex items-center rounded-md bg-purple-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-purple-700 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M10 12H8"/><path d="M16 12h-2"/><path d="M16 16h-6"/><path d="M8 16h2"/></svg>
                    Cetak Akuan
                </a>

                <!-- Pautan Halaman Cetak Sijil -->
                <a href="sijil.html" target="_blank" title="Cetak Sijil Berhenti" class="inline-flex items-center rounded-md bg-pink-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-pink-700 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><path d="M6 14h12v7H6z"/></svg>
                    Cetak Sijil
                </a>

                <a href="https://docs.google.com/spreadsheets/d/1vI6gHBDzU8qSap1wxrub0VDYf8uCVyVZRzcUzEVRbEc/edit?usp=sharing" target="_blank" title="Lihat Data Pengisian Borang Murid" class="inline-flex items-center rounded-md bg-gray-500 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-gray-600 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M12 18v-6"/><path d="M9 15h6"/></svg>
                    Data Murid
                </a>
                <a href="https://docs.google.com/spreadsheets/d/18vpqeqMOwrCVwyjZUOVO_fsYX2bpzQPzOUhPbNqTERA/edit?usp=sharing" target="_blank" title="Lihat Data Penilaian Guru" class="inline-flex items-center rounded-md bg-yellow-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-yellow-700 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/><path d="M12 10v4"/></svg>
                    Penilaian Guru
                </a>
            </div>

            <div id="status-mesej" class="text-sm font-medium text-gray-600 order-2 sm:order-3 w-full text-center sm:text-right"></div>
        </div>

        <!-- Kontena Jadual dengan 'overflow' untuk responsif -->
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bil.</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Murid</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. IC</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tingkatan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status Penilaian</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tindakan</th>
                        </tr>
                    </thead>
                    <tbody id="jadual-murid" class="bg-white divide-y divide-gray-200">
                        <!-- Data murid akan dimasukkan oleh JavaScript di sini -->
                        <tr>
                            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                Sila tekan butang "Muat Semula Data" untuk memaparkan maklumat.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <p class="text-xs text-gray-500 text-center mt-4">
            Nota: Pautan butang "Tindakan" di bawah adalah contoh.
        </p>

    </div>

    <!-- === MODAL PENILAIAN MURID TUNGGAL (GABUNGAN) === -->
    <div id="penilaian-murid-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden modal-overlay">
        <!-- Modal Content (Lebar lebih besar untuk borang) -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl modal-body-scroll">
            <div class="p-6 sm:p-8">
                <h3 class="text-2xl font-bold text-indigo-700 border-b border-indigo-200 pb-3 mb-4">Penilaian Komprehensif Murid</h3>
                
                <form id="penilaian-murid-form" class="mt-4 space-y-6">
                    <!-- Maklumat Asas Murid -->
                    <div class="p-4 border border-indigo-200 rounded-lg bg-indigo-50/50 space-y-1">
                        <p class="text-sm font-medium">Nama Murid: <span id="penilaian-nama-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">No. K/P: <span id="penilaian-ic-murid" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Kelas/Tingkatan: <span id="penilaian-tingkatan" class="font-semibold text-indigo-800"></span></p>
                        <p class="text-sm font-medium">Tahun Penilaian: <span id="penilaian-tahun" class="font-semibold text-indigo-800"></span></p>
                        <!-- Maklumat penting yang disembunyikan untuk proses penghantaran data -->
                        <input type="hidden" id="penilaian-ic-hidden"> 
                        <input type="hidden" id="penilaian-tarikh-masuk">
                        <input type="hidden" id="penilaian-tarikh-berhenti">
                    </div>


                    <!-- === BAHAGIAN 1: Sijil Pencapaian Khas === -->
                    <h2 class="text-xl font-bold text-gray-900 border-b pb-2 pt-4">Sijil Pencapaian Khas</h2>
                    
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">1. Program Anugerah Skim Lencana Bintang</h4>
                    <div id="lencana-bintang-options" class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Cemerlang" class="custom-radio">
                                <span class="text-sm">Cemerlang (7 Bintang - merit ke atas)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Baik" class="custom-radio">
                                <span class="text-sm">Baik (3-4 Bintang - 840-1919 mata merit)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan (1-2 Bintang - 240-839 mata merit)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="lencana-bintang" value="Kurang Memuaskan" class="custom-radio">
                                <span class="text-sm">Kurang Memuaskan (Kurang daripada 240 mata merit)</span>
                            </label>
                        </div>
                    </div>

                    <h4 class="text-lg font-semibold text-gray-800 mt-4">2. Program Nilam (Nadi Ilmu Amalan Membaca)</h4>
                    <div id="program-nilam-options" class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="5 Bintang" class="custom-radio">
                                <span class="text-sm">5 Bintang (600+ bahan bacaan ke atas)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="4 Bintang" class="custom-radio">
                                <span class="text-sm">4 Bintang (480-599 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="3 Bintang" class="custom-radio">
                                <span class="text-sm">3 Bintang (360-479 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="2 Bintang" class="custom-radio">
                                <span class="text-sm">2 Bintang (240-359 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="1 Bintang" class="custom-radio">
                                <span class="text-sm">1 Bintang (120-239 bahan bacaan)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="program-nilam" value="Tidak Mencapai" class="custom-radio">
                                <span class="text-sm">Tidak mencapai tahap (Kurang daripada 120 bahan bacaan)</span>
                            </label>
                        </div>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">3. Prestasi Kehadiran Sekolah (Sijil Khas)</h4>
                    <div id="prestasi-hadir-options-khas" class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir-khas" value="Cemerlang" class="custom-radio">
                                <span class="text-sm">Cemerlang (98-100%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir-khas" value="Baik" class="custom-radio">
                                <span class="text-sm">Baik (90-97%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir-khas" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan (85-89%)</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-hadir-khas" value="Kurang Memuaskan" class="custom-radio">
                                <span class="text-sm">Kurang Memuaskan (Kurang daripada 85%)</span>
                            </label>
                        </div>
                    </div>


                    <!-- === BAHAGIAN 2: Surat Akuan === -->
                    <h2 class="text-xl font-bold text-gray-900 border-b pb-2 pt-4">Surat Akuan</h2>
                    
                    <!-- A. Prestasi Akademik -->
                    <h4 class="text-lg font-semibold text-gray-800 mt-4">A. Prestasi Akademik</h4>
                    <div class="flex flex-wrap items-center gap-6 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                        <label class="text-sm font-medium text-gray-700">Pencapaian:</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Cemerlang" class="custom-radio">
                                <span class="text-sm">Cemerlang</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Baik" class="custom-radio" checked>
                                <span class="text-sm">Baik</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Memuaskan" class="custom-radio">
                                <span class="text-sm">Memuaskan</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" name="prestasi-akademik" value="Tidak Memuaskan" class="custom-radio">
                                <span class="text-sm">Tidak Memuaskan</span>
                            </label>
                        </div>
                    </div>


                    <!-- B. Kualiti Peribadi -->
                    <h4 class="text-lg font-semibold text-gray-800">B. Kualiti Peribadi</h4>
                    <div class="overflow-x-auto border rounded-lg shadow-sm">
                        <table class="min-w-full modal-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="w-1/3">Kualiti</th>
                                    <th class="text-center">Cemerlang</th>
                                    <th class="text-center">Baik</th>
                                    <th class="text-center">Memuaskan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="row-bertanggungjawab">
                                    <td>i) Bertanggungjawab</td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-1" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-dayausaha">
                                    <td>ii) Daya usaha</td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-2" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-jujur">
                                    <td>iii) Jujur</td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-3" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-keyakinan">
                                    <td>iv) Keyakinan diri</td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-4" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-kepimpinan">
                                    <td>v) Kepimpinan</td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-5" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-kesopanan">
                                    <td>vi) Kesopanan</td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-6" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                                <tr id="row-disiplin">
                                    <td>vii) Disiplin</td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Cemerlang" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Baik" class="custom-radio" checked></td>
                                    <td class="text-center"><input type="radio" name="gred-7" value="Memuaskan" class="custom-radio"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- C. Tugas Khas / Jawatan Khas (Checkbox) -->
                    <h4 class="text-lg font-semibold text-gray-800">C. Tugas Khas / Jawatan Khas (Pilih yang berkaitan)</h4>
                    <div class="overflow-x-auto border rounded-lg shadow-sm">
                        <table class="min-w-full modal-table">
                            <thead>
                                <tr>
                                    <th class="w-1/3">Tugas Khas</th>
                                    <th class="text-center">Ketua</th>
                                    <th class="text-center">Penolong Ketua/Setiausaha/Bendahari/Ketua Biro</th>
                                    <th class="text-center">Ahli Jawatankuasa</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="jaw-1">
                                    <td>1. Pengawas Sekolah</td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-1" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-2">
                                    <td>2. Pengawas Tingkatan</td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-2" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-3">
                                    <td>3. Pengawas Asrama</td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-3" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-4">
                                    <td>4. Pengawas Kelas</td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-4" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-5">
                                    <td>5. Pengawas Perpustakaan</td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Ketua" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Penolong" class="custom-radio"></td>
                                    <td class="text-center"><input type="radio" name="jaw-5" value="Ahli" class="custom-radio"></td>
                                </tr>
                                <tr id="jaw-6">
                                    <td>6. Lain-lain (Nyatakan)</td>
                                    <td colspan="3"><input type="text" id="jaw-lain" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- D. Kehadiran (Surat Akuan) -->
                    <h4 class="text-lg font-semibold text-gray-800">D. Kehadiran Sekolah (Surat Akuan)</h4>
                    <div class="flex items-center space-x-4">
                        <label for="peratus-hadir" class="text-sm font-medium text-gray-700">Peratus Kehadiran (%):</label>
                        <input type="number" id="peratus-hadir" value="100" min="0" max="100" class="w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    
                    <!-- E. Catatan -->
                    <h4 class="text-lg font-semibold text-gray-800">E. Catatan</h4>
                    <div>
                        <textarea id="catatan-tambahan" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>

                    <!-- Input tersembunyi untuk menyimpan URL API guru (untuk simpan penilaian) -->
                    <input type="hidden" id="sheetdb-url-guru" value="https://sheetdb.io/api/v1/ox3yu9lw1ua8g">

                    <!-- Butang Aksi -->
                    <div class="pt-4 flex justify-between space-x-3 border-t border-gray-200">
                        <button type="button" id="cetak-akuan-btn" class="rounded-md bg-pink-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-pink-700 transition duration-150 ease-in-out">
                            Jana Surat Akuan & Sijil Khas (Print)
                        </button>
                        <div class="flex space-x-3">
                            <button type="button" id="tutup-penilaian-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition duration-150 ease-in-out">
                                Tutup
                            </button>
                            <button type="button" id="simpan-penilaian-btn" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 transition duration-150 ease-in-out">
                                Simpan Data Penilaian
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- === TAMAT MODAL PENILAIAN MURID TUNGGAL === -->


    <!-- === MODAL PENGESAHAN SIMPAN GURU === -->
    <div id="confirm-simpan-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold text-gray-900">Sahkan Penyimpanan Data</h3>
            <p class="mt-2 text-sm text-gray-600">Anda pasti ingin menyimpan dan mengemaskini maklumat penilaian ini?</p>
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="batal-simpan-btn" class="rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    Batal
                </button>
                <button type="button" id="teruskan-simpan-btn" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    Ya, Simpan
                </button>
            </div>
        </div>
    </div>
    <!-- === TAMAT MODAL PENGESAHAN SIMPAN GURU === -->


    <!-- Skrip JavaScript untuk memuat data dari SheetDB -->
    <script type="module">
        // URL API SheetDB untuk data murid (sumber data jadual)
        const sheetDBUrlMurid = "https://sheetdb.io/api/v1/VJ0QYRSKTFYY0"; 
        // Pembolehubah untuk menyimpan semua data murid yang dimuatkan
        let dataMuridGlobal = []; 
        let dataPenilaianGlobal = []; // Untuk menyimpan semua data penilaian guru

        // Dapatkan elemen DOM
        const muatDataBtn = document.getElementById('muat-data-btn');
        const muatIkon = document.getElementById('muat-ikon');
        const muatTeks = document.getElementById('muat-teks');
        const jadualBody = document.getElementById('jadual-murid');
        const statusMesej = document.getElementById('status-mesej');
        
        // Analisis DOM (BARU)
        const analisisJumlah = document.getElementById('analisis-jumlah');
        const analisisSelesai = document.getElementById('analisis-selesai');
        const analisisBelum = document.getElementById('analisis-belum');
        
        // Elemen Modal Penilaian Tunggal
        const penilaianMuridModal = document.getElementById('penilaian-murid-modal');
        const tutupPenilaianBtn = document.getElementById('tutup-penilaian-btn');
        const simpanPenilaianBtn = document.getElementById('simpan-penilaian-btn');
        const penilaianMuridForm = document.getElementById('penilaian-murid-form');
        const cetakAkuanBtn = document.getElementById('cetak-akuan-btn'); // Butang cetak akuan

        // Elemen Modal Pengesahan Simpan
        const confirmSimpanModal = document.getElementById('confirm-simpan-modal');
        const batalSimpanBtn = document.getElementById('batal-simpan-btn');
        const teruskanSimpanBtn = document.getElementById('teruskan-simpan-btn');
        

        // Tutup modal penilaian bila butang 'Tutup' diklik
        if (tutupPenilaianBtn) {
            tutupPenilaianBtn.addEventListener('click', () => {
                penilaianMuridModal.classList.add('hidden');
            });
        }
        
        // Tutup modal bila overlay diklik
        if (penilaianMuridModal) {
            penilaianMuridModal.addEventListener('click', (e) => {
                const modalContent = penilaianMuridModal.querySelector('.bg-white');
                if (modalContent && !modalContent.contains(e.target)) {
                    penilaianMuridModal.classList.add('hidden');
                }
            });
        }
        
        // Fungsi untuk format tarikh (YYYY-MM-DD -> DD/MM/YYYY)
        const formatTarikh = (tarikhStr) => {
            if (!tarikhStr) return '';
            const [tahun, bulan, hari] = tarikhStr.split('-');
            if (tahun && bulan && hari) {
                // Format kepada DD/MM/YYYY (gaya yang biasa digunakan dalam dokumen)
                return `${hari}/${bulan}/${tahun}`;
            }
            return tarikhStr; // Pulangkan asal jika format salah
        };
        
        // Fungsi untuk memformat cap masa
        const formatCapMasa = (timestamp) => {
            if (!timestamp) return 'n/a';
            try {
                const date = new Date(timestamp);
                if (isNaN(date)) return 'n/a'; 

                const tarikh = date.toLocaleDateString('ms-MY', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const masa = date.toLocaleTimeString('ms-MY', { hour: '2-digit', minute: '2-digit', hour12: true });
                
                return `<div class="status-time">Tarikh: ${tarikh.toLowerCase()}<br>Masa: ${masa.toLowerCase()}</div>`;
            } catch (e) {
                return 'n/a';
            }
        };

        // Fungsi untuk paparkan mesej status sementara di dalam jadual guru
        const tunjukStatusGuru = (mesej, jenis = 'info') => {
            if (!statusMesej) return;
            statusMesej.innerText = mesej;
            statusMesej.classList.remove('text-red-600', 'text-green-700', 'text-gray-600');
            if (jenis === 'gagal') {
                statusMesej.classList.add('text-red-600');
            } else if (jenis === 'berjaya') {
                statusMesej.classList.add('text-green-700');
            } else {
                statusMesej.classList.add('text-gray-600');
            }

            // Sembunyikan selepas 5 saat jika bukan loading
            if (jenis !== 'loading') {
                setTimeout(() => {
                    statusMesej.innerText = 'Sedia.';
                    statusMesej.classList.remove('text-red-600', 'text-green-700');
                    statusMesej.classList.add('text-gray-600');
                }, 5000);
            }
        };
        
        const tutupModal = (modalElement) => {
            if (modalElement) modalElement.classList.add('hidden');
        }

        // Fungsi untuk mencari rekod penilaian sedia ada (jika ada)
        const cariRekodPenilaian = (ic, jenisDokumen) => {
            // SheetDB tidak sensitif huruf besar/kecil. Kita cari IC dan jenis dokumen.
            const rekod = dataPenilaianGlobal.find(rekod => 
                (rekod.IC === ic || rekod.IC === ic.toUpperCase()) && 
                (rekod['Jenis Dokumen'] === jenisDokumen)
            );
            
            // Perhatian: SheetDB sering menggunakan 'Timestamp' atau 'Date' untuk cap masa.
            // Kita cuba cari mana-mana medan masa yang wujud.
            if (rekod) {
                // PRIORITIZE: Tarikh Penilaian (manual) -> Timestamp (auto) -> Medan lain
                const latestTimestamp = rekod['Tarikh Penilaian'] || rekod.Timestamp || rekod.Date || rekod['Tarikh Masuk'] || null;
                if (latestTimestamp) {
                    return { ...rekod, CapMasa: latestTimestamp };
                }
            }
            return rekod;
        };
        
        // Fungsi untuk mengisi nilai radio button
        const setRadioValue = (formElement, name, value) => {
            const radio = formElement.querySelector(`input[name="${name}"][value="${value}"]`);
            if (radio) {
                radio.checked = true;
                return true;
            }
            return false;
        };
        
        // Mendapatkan nilai radio button yang dipilih
        const getRadioValue = (name) => {
            const radioChecked = penilaianMuridForm.querySelector(`input[name="${name}"]:checked`);
            return radioChecked ? radioChecked.value : '';
        };

        // Fungsi untuk memaparkan modal Penilaian Murid (Tunggal)
        window.paparModalPenilaianMurid = (index) => {
            const murid = dataMuridGlobal[index];
            const icMurid = murid['IC'] || '';
            
            // Cari rekod Komprehensif sedia ada
            const rekodKomprehensif = cariRekodPenilaian(icMurid, 'Komprehensif');
            

            if (!murid) {
                console.error("Data murid tidak ditemui.");
                return;
            }

            // --- 1. Isi Maklumat Asas & Map Data Asas Murid ---
            document.getElementById('penilaian-nama-murid').innerText = murid['Nama Murid'] || 'N/A';
            document.getElementById('penilaian-ic-murid').innerText = icMurid || 'N/A';
            document.getElementById('penilaian-tingkatan').innerText = murid['Tingkatan Tertinggi'] || 'N/A';
            document.getElementById('penilaian-tahun').innerText = new Date().getFullYear();
            
            // Simpan maklumat tersembunyi
            document.getElementById('penilaian-ic-hidden').value = icMurid || '';
            document.getElementById('penilaian-tarikh-masuk').value = murid['Tarikh Masuk'] || '';
            document.getElementById('penilaian-tarikh-berhenti').value = murid['Tarikh Berhenti'] || '';
            
            // Reset borang
            document.getElementById('penilaian-murid-form').reset();
            
            // --- 2. Pre-fill Sijil Pencapaian Khas (Lalai: Cemerlang / 5 Bintang / Cemerlang) ---
            if (rekodKomprehensif) {
                setRadioValue(penilaianMuridForm, 'lencana-bintang', rekodKomprehensif['Lencana Bintang']);
                setRadioValue(penilaianMuridForm, 'program-nilam', rekodKomprehensif['Program Nilam']);
                setRadioValue(penilaianMuridForm, 'prestasi-hadir-khas', rekodKomprehensif['Prestasi Kehadiran Sijil Khas']);
            } else {
                setRadioValue(penilaianMuridForm, 'lencana-bintang', 'Cemerlang');
                setRadioValue(penilaianMuridForm, 'program-nilam', '5 Bintang');
                setRadioValue(penilaianMuridForm, 'prestasi-hadir-khas', 'Cemerlang');
            }


            // --- 3. Pre-fill Surat Akuan (Lalai: Baik) ---
            if (rekodKomprehensif) {
                // A. Prestasi Akademik
                setRadioValue(penilaianMuridForm, 'prestasi-akademik', rekodKomprehensif.Akademik);
                
                // B. Kualiti Peribadi
                const kualitiKeys = ['Bertanggungjawab', 'Daya Usaha', 'Jujur', 'Keyakinan Diri', 'Kepimpinan', 'Kesopanan', 'Disiplin'];
                kualitiKeys.forEach((key, index) => {
                    setRadioValue(penilaianMuridForm, `gred-${index + 1}`, rekodKomprehensif[key]);
                });
                
                // C. Tugas Khas
                const jawatanKeys = ['Jawatan 1', 'Jawatan 2', 'Jawatan 3', 'Jawatan 4', 'Jawatan 5'];
                jawatanKeys.forEach((key, index) => {
                    setRadioValue(penilaianMuridForm, `jaw-${index + 1}`, rekodKomprehensif[key]);
                });
                document.getElementById('jaw-lain').value = rekodKomprehensif['Jawatan Khas Lain'] || '';

                // D & E: Kehadiran dan Catatan
                document.getElementById('peratus-hadir').value = rekodKomprehensif['Peratus Kehadiran'] || '100';
                document.getElementById('catatan-tambahan').value = rekodKomprehensif.Catatan || '';
            } else {
                // Set lalai jika tiada rekod sedia ada (Default Baik)
                setRadioValue(penilaianMuridForm, 'prestasi-akademik', 'Baik');
                for (let i = 1; i <= 7; i++) {
                    setRadioValue(penilaianMuridForm, `gred-${i}`, 'Baik');
                }
            }

            // Tunjukkan modal
            penilaianMuridModal.classList.remove('hidden');
        };

        // Fungsi utama untuk mengumpul dan menyimpan SEMUA data penilaian
        const lakukanSimpanDataKomprehensif = async () => {
            
            const apiUrl = document.getElementById('sheetdb-url-guru').value;
            const masaPenilaian = new Date().toISOString(); // Tangkap masa semasa

            // Kumpulan data pembantu
            const getRadioValue = (name) => {
                const radioChecked = penilaianMuridForm.querySelector(`input[name="${name}"]:checked`);
                return radioChecked ? radioChecked.value : '';
            };

            // Kumpul data Kualiti Peribadi (Surat Akuan)
            const kualitiPeribadiValues = [];
            for (let i = 1; i <= 7; i++) kualitiPeribadiValues.push(getRadioValue(`gred-${i}`));
            
            // Kumpul data Jawatan Khas (Surat Akuan)
            const jawatanKhasValues = [];
            for (let i = 1; i <= 5; i++) jawatanKhasValues.push(getRadioValue(`jaw-${i}`));
            
            // Cari jika rekod sedia ada (untuk tentukan PUT atau POST)
            const icUntukUpdate = document.getElementById('penilaian-ic-hidden').value;
            const rekodSediaAda = cariRekodPenilaian(icUntukUpdate, 'Komprehensif');
            
            // Gabungan Data yang akan dihantar ke SheetDB (SEBAGAI SATU REKOD)
            const dataHantar = {
                // Maklumat Asas
                'IC': icUntukUpdate,
                'Nama Murid': document.getElementById('penilaian-nama-murid').innerText,
                'Tingkatan': document.getElementById('penilaian-tingkatan').innerText,
                'Tarikh Masuk': document.getElementById('penilaian-tarikh-masuk').value,
                'Tarikh Berhenti': document.getElementById('penilaian-tarikh-berhenti').value,
                'Tahun': document.getElementById('penilaian-tahun').innerText,
                
                // BARU: Cap Masa manual
                'Tarikh Penilaian': masaPenilaian, 

                // Sijil Khas
                'Lencana Bintang': getRadioValue('lencana-bintang'),
                'Program Nilam': getRadioValue('program-nilam'),
                'Prestasi Kehadiran Sijil Khas': getRadioValue('prestasi-hadir-khas'),

                // Surat Akuan
                'Akademik': getRadioValue('prestasi-akademik'),
                'Bertanggungjawab': kualitiPeribadiValues[0], 'Daya Usaha': kualitiPeribadiValues[1],
                'Jujur': kualitiPeribadiValues[2], 'Keyakinan Diri': kualitiPeribadiValues[3],
                'Kepimpinan': kualitiPeribadiValues[4], 'Kesopanan': kualitiPeribadiValues[5],
                'Disiplin': kualitiPeribadiValues[6],
                'Jawatan 1': jawatanKhasValues[0], 'Jawatan 2': jawatanKhasValues[1],
                'Jawatan 3': jawatanKhasValues[2], 'Jawatan 4': jawatanKhasValues[3],
                'Jawatan 5': jawatanKhasValues[4], 
                'Jawatan Khas Lain': document.getElementById('jaw-lain').value,
                'Peratus Kehadiran': document.getElementById('peratus-hadir').value,
                'Catatan': document.getElementById('catatan-tambahan').value,
                
                // Jenis Rekod Tunggal
                'Jenis Dokumen': 'Komprehensif' 
            };

            // 1. Validasi URL API Guru
            if (!apiUrl || !apiUrl.startsWith('https://sheetdb.io/api/v1/')) {
                // Menggunakan console.error bukan alert
                console.error("RALAT: URL API Penilaian Guru tidak sah. Sila semak semula kod.");
                return false;
            }

            // Tentukan kaedah dan URL
            const method = rekodSediaAda ? 'PUT' : 'POST';
            const url = rekodSediaAda 
                ? `${apiUrl}/IC/${icUntukUpdate}` 
                : apiUrl;
            
            // SheetDB PUT memerlukan data dibalut dalam objek data
            const payload = { data: dataHantar };
            
            simpanPenilaianBtn.disabled = true;
            simpanPenilaianBtn.innerText = "Menyimpan...";

            try {
                const response = await fetch(url, { 
                    method: method, 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(payload) 
                });
                
                const result = await response.json();

                if (result.updated || result.created) {
                    tutupModal(penilaianMuridModal);
                    // Muat semula data murid untuk kemas kini status jadual
                    await muatDataMurid();
                    
                    const mesej = rekodSediaAda ? "Maklumat Penilaian Berjaya Dikemaskini." : "Maklumat Penilaian Komprehensif Berjaya Disimpan.";

                    tunjukStatusGuru(mesej, 'berjaya');
                    return true;
                } else {
                    console.error("Ralat SheetDB (Simpan Komprehensif):", result);
                    tunjukStatusGuru("RALAT: Gagal menyimpan/mengemaskini data penilaian. Sila semak konsol.", 'gagal');
                    return false;
                }
            } catch (error) {
                console.error("Ralat Fetch (Simpan Komprehensif):", error);
                tunjukStatusGuru("RALAT: Ralat sambungan berlaku. Gagal menyimpan data penilaian.", 'gagal');
                return false;
            } finally {
                simpanPenilaianBtn.disabled = false;
                simpanPenilaianBtn.innerText = "Simpan Data Penilaian";
            }
        };

        // === FUNGSI JANA DOKUMEN CETAK GABUNGAN BARU (NAVIGATE) ===
        // FUNGSI INI KINI DIBUANG DARI MODAL, GANTI DENGAN CETAK_AKUAN_LIST.HTML
        
        // --- PENGENDALI ACARA SIMPAN ---

        // 1. Apabila butang 'Simpan Data Penilaian' diklik (Tunjuk Modal Pengesahan)
        if (simpanPenilaianBtn) {
            simpanPenilaianBtn.addEventListener('click', (e) => {
                e.preventDefault();
                tutupModal(penilaianMuridModal); // Sembunyikan modal borang
                confirmSimpanModal.classList.remove('hidden'); // Tunjukkan modal pengesahan
            });
        }
        
        // 2. Apabila butang 'Ya, Simpan' dalam modal pengesahan diklik (Lakukan Penghantaran)
        if (teruskanSimpanBtn) {
            teruskanSimpanBtn.addEventListener('click', () => {
                tutupModal(confirmSimpanModal); // Tutup modal pengesahan
                lakukanSimpanDataKomprehensif();
            });
        }
        
        // 3. Apabila butang 'Batal' dalam modal pengesahan diklik
        if (batalSimpanBtn) {
            batalSimpanBtn.addEventListener('click', () => {
                tutupModal(confirmSimpanModal); // Tutup modal pengesahan
                penilaianMuridModal.classList.remove('hidden'); // Tunjukkan semula modal borang
            });
        }

        // Fungsi BARU untuk muat data penilaian guru dari API 2
        const muatDataPenilaian = async () => {
            const apiUrl = document.getElementById('sheetdb-url-guru').value;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    console.error("Gagal memuatkan data penilaian guru. Status:", response.status);
                    return [];
                }
                const data = await response.json();
                dataPenilaianGlobal = data;
                return data;
            } catch (error) {
                console.error('Ralat Fetch Data Penilaian Guru:', error);
                return [];
            }
        };
        
        // Fungsi untuk memuat dan memaparkan data murid
        const muatDataMurid = async () => {
            // Tunjukkan status 'loading'
            tunjukStatusGuru("Memuatkan data murid dan penilaian...", 'loading');
            muatIkon.classList.add('animate-spin-slow');
            muatTeks.innerText = "Memuatkan...";
            muatDataBtn.disabled = true;

            // Muat kedua-dua set data secara serentak
            const [muridResponse] = await Promise.all([
                fetch(sheetDBUrlMurid),
                muatDataPenilaian() 
            ]);

            try {
                if (!muridResponse.ok) {
                    throw new Error(`Ralat Rangkaian Murid: ${muridResponse.statusText}`);
                }
                const data = await muridResponse.json();
                
                dataMuridGlobal = data; 
                
                // === LOGIK PENGIRAAN ANALISIS (BARU) ===
                let jumlahMurid = dataMuridGlobal.length;
                let selesaiDinilai = 0;
                
                jadualBody.innerHTML = '';

                if (data.length === 0) {
                    jadualBody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-gray-500">Tiada data murid ditemui.</td></tr>`;
                    tunjukStatusGuru("Tiada data.");
                } else {
                    data.forEach((murid, index) => {
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-gray-50 transition duration-150";
                        
                        const icMurid = murid['IC'] || '';
                        
                        // Semak status penilaian komprehensif (REKOD TUNGGAL)
                        const rekodKomprehensif = cariRekodPenilaian(icMurid, 'Komprehensif');
                        
                        let statusHTML = `<span class="text-xs text-red-500 font-semibold">BELUM DINILAI</span>`;
                        
                        // Dianggap selesai jika rekod Komprehensif wujud
                        if (rekodKomprehensif) {
                            const latestTimestamp = rekodKomprehensif.CapMasa;
                            selesaiDinilai++; // Kira murid yang telah selesai
                            
                            statusHTML = `<div class="status-selesai"><div class="status-main"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg> Selesai</div> ${formatCapMasa(latestTimestamp)}</div>`;
                        }


                        tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${murid['Nama Murid'] || 'TIADA NAMA'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${icMurid}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${murid['Tingkatan Tertinggi'] || ''}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${statusHTML}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                <!-- BUTANG PENILAIAN MURID TUNGGAL -->
                                <button type="button" onclick="paparModalPenilaianMurid(${index})" title="Buka Borang Penilaian Murid"
                                   class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    Penilaian Murid
                                </button>
                            </td>
                        `;
                        jadualBody.appendChild(tr);
                    });
                    tunjukStatusGuru(`Berjaya memuatkan ${data.length} rekod.`);
                }
                
                // === KEMASKINI KOTAK ANALISIS ===
                analisisJumlah.innerText = jumlahMurid;
                analisisSelesai.innerText = selesaiDinilai;
                analisisBelum.innerText = jumlahMurid - selesaiDinilai;


            } catch (error) {
                console.error('Gagal memuatkan data murid:', error);
                tunjukStatusGuru("Gagal memuatkan data murid. Sila semak konsol.", 'gagal');
                jadualBody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-red-500">Ralat: Gagal mendapatkan data murid.</td></tr>`;
            } finally {
                // Berhentikan status 'loading'
                muatIkon.classList.remove('animate-spin-slow');
                muatTeks.innerText = "Muat Semula Data";
                muatDataBtn.disabled = false;
            }
        };

        // Tambah 'event listener' pada butang
        muatDataBtn.addEventListener('click', muatDataMurid);
        
        // Muat data secara automatik semasa halaman dibuka
        muatDataMurid();

    </script>
</body>
</html>
