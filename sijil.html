<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetak Sijil Berhenti Sekolah</title>
    <!-- Muat naik Tailwind CSS untuk penggayaan -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan fon Inter */
        body { font-family: 'Inter', sans-serif; }
        
        /* Mengurangkan saiz fon templat sijil kepada 10pt untuk memastikan ia muat A4 */
        .certificate-page { 
            width: 794px; /* A4 width (Dikekalkan untuk tujuan paparan) */
            padding: 30px 40px; 
            font-family: 'Times New Roman', serif;
            font-size: 10pt; 
            box-shadow: 0 0 5px rgba(0,0,0,0.2); 
            margin: 20px auto;
            position: relative;
        }

        .sijil-data-underline { border-bottom: 1px dashed #000; padding: 0 5px; font-weight: bold; display: inline-block; min-width: 150px; text-transform: uppercase; white-space: normal; }
        .sijil-field-name { font-size: 8pt; font-style: italic; color: #555; display: block; margin-top: 2px; }
        .flex-row-sijil { display: flex; align-items: flex-end; margin-bottom: 12px; }
        .flex-col-sijil { flex: 1; padding-right: 15px; }

        /* === STYLING KRITIKAL UNTUK CETAKAN (PRINT) === */
        @media print {
            body { 
                background: white !important; 
                margin: 0; /* Pastikan margin badan 0 */
                padding: 0;
            }
            .print-hidden { display: none !important; } /* Sembunyikan semua butang/jadual */
            
            /* Tetapkan saiz kertas dan margin minimum */
            @page { 
                size: A4 portrait;
                margin: 0.5cm; /* Margin dikurangkan untuk memuatkan kandungan */
            } 
            
            .certificate-page { 
                width: 100%; 
                margin: 0; 
                box-shadow: none; 
                border: none;
                /* Pastikan tiada page break di dalam sijil */
                page-break-inside: avoid !important;
                page-break-after: always; /* Pastikan setiap sijil berada di halaman baru */
            }
            .certificate-page:last-child {
                page-break-after: auto;
            }
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin 1.5s linear infinite; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 text-gray-800">

    <div id="app-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 print-hidden">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">Pusat Cetakan Sijil Berhenti Sekolah</h1>
        <p class="text-center text-gray-600 mb-8">
            Guru boleh mencetak sijil secara individu atau pukal (menggunakan dialog cetak pelayar).
        </p>

        <!-- Butang Kawalan -->
        <div class="flex flex-wrap justify-between items-center mb-6 space-y-3 sm:space-y-0">
            <button type="button" id="muat-data-btn" class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-indigo-500 transition duration-150 ease-in-out w-full sm:w-auto">
                <svg id="muat-ikon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101A7.002 7.002 0 0112.001 4c3.865 0 7 3.134 7 7s-3.135 7-7 7-7-3.134-7-7c0-1.554.506-3.018 1.39-4.215l1.415 1.414A4.982 4.982 0 007.001 11c0 2.757 2.243 5 5 5s5-2.243 5-5-2.243-5-5-5a4.984 4.984 0 00-4.23 2.508l2.13.001a1 1 0 010 2H4.001a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                <span id="muat-teks">Muat Semula Data</span>
            </button>
            
            <button type="button" id="cetak-pukal-btn" class="inline-flex items-center rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-green-700 transition duration-150 ease-in-out w-full sm:w-auto disabled:opacity-50" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><path d="M6 14h12v7H6z"/></svg>
                Cetak Pukal Semua Sijil (Print)
            </button>
        </div>
        
        <!-- Peringatan Cetakan (BARU) -->
        <div id="print-alert" class="p-3 mb-4 text-sm font-medium text-yellow-800 bg-yellow-100 rounded-lg hidden">
            <p class="font-bold">PERHATIAN PENTING SEBELUM MENCETAK:</p>
            <p>Sila pastikan tetapan skala ("Scale") di dalam dialog cetak pelayar anda ditetapkan kepada **90%** (atau pilih "Fit to Page" / "Muatkan ke Halaman") untuk memastikan sijil muat dalam satu halaman A4.</p>
        </div>
        
        <!-- Jadual Murid -->
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bil.</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Murid</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. IC</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tingkatan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tindakan</th>
                        </tr>
                    </thead>
                    <tbody id="jadual-murid" class="bg-white divide-y divide-gray-200">
                        <tr><td colspan="5" class="px-6 py-12 text-center text-gray-500">Sila tekan butang "Muat Semula Data" untuk memaparkan maklumat.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <p id="status-mesej" class="text-sm font-medium text-gray-600 text-center mt-4"></p>
        
    </div>

    <!-- === TEMPLAT SIJIL (DIISI SEMASA CETAK) === -->
    <div id="sijil-container" class="hidden">
        
        <!-- Sijil template akan diduplikat ke sini untuk cetakan pukal -->
        <div data-template="sijil-page" class="certificate-page">
            <div style="font-size: 10pt; text-align: left;">PENDUA</div>
            <div style="text-align: right; margin-bottom: 20px;">
                <!-- Jata Negara (Placeholder) -->
                <img src="https://placehold.co/40x48/ffffff/000000?text=JATA" alt="Jata Negara Placeholder" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%);">
                
                <span id="sijil-no-siri" style="font-size: 14pt; font-weight: bold; margin-right: 80px;">A 758701</span>
                <p style="font-size: 8pt; margin-top: 2px; font-style: italic; text-align: right; margin-right: 80px;">Nombor Siri / Serial Number</p>
            </div>
            
            <h1 style="font-size: 16pt; font-weight: bold; margin-bottom: 5px; text-align: center;">SIJIL BERHENTI SEKOLAH KERAJAAN</h1>
            <p style="font-size: 12pt; font-style: italic; margin-bottom: 40px; text-align: center;">Government School Leaving Certificate</p>

            <!-- Bahagian Data Murid -->
            <div style="line-height: 1.4;">
                
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 2;">
                        Nama Murid:<span class="sijil-data-underline" id="pdf-nama-murid" style="min-width: 400px; max-width: 450px;"></span>
                        <span class="sijil-field-name">Name of Pupil</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Jantina:<span class="sijil-data-underline" id="pdf-jantina" style="min-width: 150px; max-width: 170px;"></span>
                        <span class="sijil-field-name">Sex</span>
                    </div>
                </div>

                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 1.5;">
                        Tempat dan Tarikh Lahir:<span class="sijil-data-underline" id="pdf-tempat-lahir" style="min-width: 250px;"></span>
                        <span class="sijil-field-name">Place and Date of Birth</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Warganegara:<span class="sijil-data-underline" id="pdf-warganegara" style="min-width: 150px;"></span>
                        <span class="sijil-field-name">Nationality</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Kumpulan Etnik:<span class="sijil-data-underline" id="pdf-kumpulan-etnik" style="min-width: 150px;"></span>
                        <span class="sijil-field-name">Ethnic Group</span>
                    </div>
                </div>
                
                <div class="flex-row-sijil" style="display: block;">
                    Nama dan Alamat Bapa/Ibu/Penjaga:<span class="sijil-data-underline" id="pdf-nama-alamat-penjaga" style="min-width: 650px; display: block; margin-top: 5px;"></span>
                    <span class="sijil-field-name">Name and Address of Father/Mother/Guardian</span>
                </div>

                <div style="height: 30px;"></div>

                <div class="flex-row-sijil">
                    <div class="flex-col-sijil">
                        Sekolah:<span class="sijil-data-underline" id="pdf-sekolah"></span>
                        <span class="sijil-field-name">School</span>
                    </div>
                    <div class="flex-col-sijil">
                        Bahasa Pengantar:<span class="sijil-data-underline" id="pdf-bahasa-pengantar"></span>
                        <span class="sijil-field-name">Medium of Instruction</span>
                    </div>
                </div>
                
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil">
                        Tarikh Kemasukan:<span class="sijil-data-underline" id="pdf-tarikh-masuk"></span>
                        <span class="sijil-field-name">Date of Admission</span>
                    </div>
                    <div class="flex-col-sijil">
                        Nombor Pendaftaran Sekolah:<span class="sijil-data-underline" id="pdf-no-daftar"></span>
                        <span class="sijil-field-name">School Registration Number</span>
                    </div>
                </div>
                
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil">
                        Tarikh Berhenti:<span class="sijil-data-underline" id="pdf-tarikh-berhenti"></span>
                        <span class="sijil-field-name">Date of Leaving</span>
                    </div>
                    <div class="flex-col-col-sijil">
                        Darjah/Tingkatan Tertinggi Dihadiri:<span class="sijil-data-underline" id="pdf-tingkatan-tertinggi"></span>
                        <span classil-field-name">Highest Class Attended</span>
                    </div>
                </div>
                
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 1.5;">
                        Sebab Berhenti:<span class="sijil-data-underline" id="pdf-sebab-berhenti" style="min-width: 350px;"></span>
                        <span class="sijil-field-name">Reason for Leaving</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Peperiksaan Awam Diduduki:<span class="sijil-data-underline" id="pdf-peperiksaan-awam" style="min-width: 180px;"></span>
                        <span class="sijil-field-name">Public Examinations Sat</span>
                    </div>
                </div>
                
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 1.5;">
                        Sekolah Terdahulu:<span class="sijil-data-underline" id="pdf-sekolah-terdahulu" style="min-width: 350px;"></span>
                        <span class="sijil-field-name">Schools Previously Attended</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Minat atau Kebolehan Khas:<span class="sijil-data-underline" id="pdf-minat-khas" style="min-width: 180px;"></span>
                        <span class="sijil-field-name">Special Interests or Abilities</span>
                    </div>
                </div>
                
                <div style="height: 30px;"></div>
                
                <div class="flex-row-sijil" style="display: block;">
                    Komen Guru Besar/Pengetua:<span class="sijil-data-underline" id="pdf-komen-pengetua" style="min-width: 650px; display: block; margin-top: 5px; line-height: 1.8;"></span>
                    <span class="sijil-field-name">Headmaster's/Principal's Comments</span>
                </div>
                
                <div style="height: 50px;"></div>
                
                <!-- Tandatangan -->
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 1;">
                        <div style="height: 50px; border-bottom: 1px solid #000; margin-bottom: 5px;"></div>
                        Tandatangan Murid
                        <span class="sijil-field-name">Signature of Pupil</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        <div style="height: 50px; border-bottom: 1px solid #000; margin-bottom: 5px;"></div>
                        Tandatangan Guru Besar/Pengetua
                        <span class="sijil-field-name">Signature of Headmaster/Principal</span>
                    </div>
                </div>
                
                <!-- Tarikh dan Cop Sekolah -->
                <div class="flex-row-sijil">
                    <div class="flex-col-sijil" style="flex: 1;">
                        Tarikh:<span class="sijil-data-underline" id="pdf-tarikh-hari-ini" style="min-width: 150px;"></span>
                        <span class="sijil-field-name">Date</span>
                    </div>
                    <div class="flex-col-sijil" style="flex: 1;">
                        Cop Sekolah:<span class="sijil-data-underline" id="pdf-cop-sekolah" style="min-width: 150px;"></span>
                        <span class="sijil-field-name">School Chop</span>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <script type="module">
        const sheetDBUrlMurid = "https://sheetdb.io/api/v1/VJ0QYRSKTFYY0";
        let dataMuridGlobal = [];
        
        const muatDataBtn = document.getElementById('muat-data-btn');
        const muatIkon = document.getElementById('muat-ikon');
        const muatTeks = document.getElementById('muat-teks');
        const jadualBody = document.getElementById('jadual-murid');
        const statusMesej = document.getElementById('status-mesej');
        const cetakPukalBtn = document.getElementById('cetak-pukal-btn');
        const sijilContainer = document.getElementById('sijil-container');
        const printAlert = document.getElementById('print-alert');
        
        // Menggunakan .outerHTML untuk menangkap DIV templat penuh
        const sijilTemplateElement = document.querySelector('[data-template="sijil-page"]');
        sijilTemplateElement.removeAttribute('data-template'); // Buang atribut template
        const sijilTemplateHtml = sijilTemplateElement.outerHTML;


        const tunjukStatus = (mesej, jenis = 'info') => {
            if (!statusMesej) return;
            statusMesej.innerText = mesej;
            statusMesej.classList.remove('text-red-600', 'text-green-700', 'text-gray-600');
            if (jenis === 'gagal') {
                statusMesej.classList.add('text-red-600');
            } else if (jenis === 'berjaya') {
                statusMesej.classList.add('text-green-700');
            } else {
                statusMesej.classList.add('text-gray-600');
            }
        };

        const formatDateForPrint = (dateString) => {
            if (!dateString) return '';
            const parts = dateString.split('-');
            if (parts.length === 3) {
                return `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            return dateString;
        };

        // Fungsi untuk mengisi data murid ke dalam templat sijil
        const kemaskiniTemplatSijil = (data, templateElement) => {
            if (!templateElement) return;

            const tarikhLahirPenuh = data['Tarikh Lahir'] ? `${data['Tempat Lahir']} PADA ${formatDateForPrint(data['Tarikh Lahir'])}` : `${data['Tempat Lahir']}`;
            const namaAlamatPenjaga = `${data['Nama Penjaga'] || 'N/A'} BERALAMAT ${data['Alamat Penjaga'] ? data['Alamat Penjaga'].replace(/, /g, ' DI ') : 'N/A'}`;
            const tarikhHariIni = formatDateForPrint(new Date().toISOString().slice(0, 10));

            const dataMap = {
                'pdf-nama-murid': data['Nama Murid'] || '----------------',
                'pdf-jantina': data.Jantina || '----------------',
                'pdf-tempat-lahir': tarikhLahirPenuh || '----------------',
                'pdf-warganegara': data.Warganegara || '----------------',
                'pdf-kumpulan-etnik': data.Etnik || '----------------',
                'pdf-nama-alamat-penjaga': namaAlamatPenjaga,
                'pdf-sekolah': data.Sekolah || 'SMK LUTONG, MIRI',
                'pdf-bahasa-pengantar': data['Bahasa Pengantar'] || 'BAHASA MELAYU',
                'pdf-tarikh-masuk': formatDateForPrint(data['Tarikh Masuk']) || '----------------',
                'pdf-tarikh-berhenti': formatDateForPrint(data['Tarikh Berhenti']) || '----------------',
                'pdf-tingkatan-tertinggi': data['Tingkatan Tertinggi'] || '----------------',
                'pdf-sebab-berhenti': data['Sebab Berhenti'] || '----------------',
                'pdf-peperiksaan-awam': data['Peperiksaan Awam'] || '----------------',
                'pdf-sekolah-terdahulu': data['Sekolah Terdahulu'] || 'TIADA',
                'pdf-minat-khas': data['Minat / Kebolehan Khas'] || '----------------',
                'pdf-komen-pengetua': data['Komen Pengetua'] || '----------------',
                'pdf-no-daftar': 'N/A', 
                'pdf-cop-sekolah': 'SMK LUTONG',
                'pdf-tarikh-hari-ini': tarikhHariIni,
            };

            for (const id in dataMap) {
                const el = templateElement.querySelector(`#${id}`);
                if (el) {
                    el.innerText = dataMap[id];
                }
            }
        };
        
        // Fungsi CETAK INDIVIDU BARU
        window.cetakIndividu = (index) => {
            const data = dataMuridGlobal[index];
            if (!data) return;

            tunjukStatus(`Menyediakan sijil untuk ${data['Nama Murid']}...`, 'info');
            printAlert.classList.remove('hidden'); // Tunjukkan peringatan skala

            // 1. Dapatkan templat sijil
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = sijilTemplateHtml; 
            const sijilElement = tempDiv.querySelector('.certificate-page'); 
            
            if (!sijilElement) {
                tunjukStatus("RALAT: Gagal mencari elemen sijil dalam templat.", 'gagal');
                return;
            }

            // Gantikan sijil-container dengan elemen sijil yang diisi (untuk dicetak)
            sijilContainer.innerHTML = '';
            sijilContainer.appendChild(sijilElement);
            sijilContainer.classList.remove('hidden'); 
            
            // 2. Isi data
            kemaskiniTemplatSijil(data, sijilElement);

            // 3. Panggil dialog cetak (Print Dialog)
            window.print();
            
            // 4. Bersihkan bekas sijil selepas cetak
            setTimeout(() => {
                sijilContainer.innerHTML = sijilTemplateHtml; // Kembalikan templat asal
                sijilContainer.classList.add('hidden');
                printAlert.classList.add('hidden'); // Sembunyikan peringatan skala
                tunjukStatus(`Sedia. Sijil ${data['Nama Murid']} telah dihantar ke dialog cetak.`, 'berjaya');
            }, 500); 
        };
        
        // Fungsi Cetak Pukal (Menggunakan window.print() )
        const cetakPukal = () => {
            if (dataMuridGlobal.length === 0) {
                tunjukStatus("Tiada data murid untuk dicetak.", 'gagal');
                return;
            }

            tunjukStatus("Menyediakan sijil untuk cetakan pukal (Print Dialog)...", 'info');
            printAlert.classList.remove('hidden'); // Tunjukkan peringatan skala
            
            // 1. Kosongkan bekas sijil
            sijilContainer.innerHTML = '';
            sijilContainer.classList.remove('hidden');

            // 2. Isi setiap sijil ke dalam bekas
            dataMuridGlobal.forEach(data => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = sijilTemplateHtml;
                const sijilElement = tempDiv.querySelector('.certificate-page');
                
                if (sijilElement) {
                    // Isi data
                    kemaskiniTemplatSijil(data, sijilElement);
                    sijilContainer.appendChild(sijilElement);
                }
            });

            // 3. Panggil dialog cetak pelayar
            window.print();

            // 4. Sembunyikan semula selepas cetak
            setTimeout(() => {
                sijilContainer.innerHTML = sijilTemplateHtml; // Kembalikan templat asal
                sijilContainer.classList.add('hidden');
                printAlert.classList.add('hidden'); // Sembunyikan peringatan skala
                tunjukStatus(`Sedia. ${dataMuridGlobal.length} sijil telah dihantar ke dialog cetak.`, 'berjaya');
            }, 500); // Beri masa untuk dialog cetak muncul
        };


        const muatDataMurid = async () => {
            tunjukStatus("Memuatkan data murid...", 'info');
            muatIkon.classList.add('animate-spin-slow');
            muatTeks.innerText = "Memuatkan...";
            muatDataBtn.disabled = true;
            cetakPukalBtn.disabled = true;

            try {
                const response = await fetch(sheetDBUrlMurid);
                if (!response.ok) {
                    throw new Error(`Ralat Rangkaian: ${response.statusText}`);
                }
                const data = await response.json();
                
                dataMuridGlobal = data.filter(d => d['Nama Murid'] && d['IC']); 
                
                jadualBody.innerHTML = '';

                if (dataMuridGlobal.length === 0) {
                    jadualBody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-gray-500">Tiada data murid ditemui atau data tidak lengkap.</td></tr>`;
                    tunjukStatus("Tiada data murid lengkap.", 'info');
                } else {
                    dataMuridGlobal.forEach((murid, index) => {
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-gray-50 transition duration-150";
                        
                        // Menukar onclick dari janaPdfIndividu kepada cetakIndividu
                        tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${murid['Nama Murid'] || 'TIADA NAMA'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${murid['IC'] || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${murid['Tingkatan Tertinggi'] || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                <button type="button" onclick="cetakIndividu(${index})" title="Cetak Sijil Individu"
                                   class="inline-flex items-center rounded-md bg-green-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-green-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><path d="M6 14h12v7H6z"/></svg>
                                    CETAK
                                </button>
                                <a href="https://docs.google.com/spreadsheets/d/1vI6gHBDzU8qSap1wxrub0VDYf8uCVyVZRzcUzEVRbEc/edit#gid=0" target="_blank" title="Lihat Rekod Data Asal"
                                   class="inline-flex items-center rounded-md bg-gray-500 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-gray-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 14V3"/><path d="M7 10l5 5 5-5"/><path d="M18 20H6a2 2 0 01-2-2v-3"/></svg>
                                    Data Asal
                                </a>
                            </td>
                        `;
                        jadualBody.appendChild(tr);
                    });
                    tunjukStatus(`Berjaya memuatkan ${dataMuridGlobal.length} rekod.`, 'berjaya');
                    cetakPukalBtn.disabled = false;
                }

            } catch (error) {
                console.error('Gagal memuatkan data murid:', error);
                tunjukStatus("Gagal memuatkan data murid. Sila semak URL SheetDB.", 'gagal');
                jadualBody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-red-500">Ralat: Gagal mendapatkan data murid.</td></tr>`;
            } finally {
                muatIkon.classList.remove('animate-spin-slow');
                muatTeks.innerText = "Muat Semula Data";
                muatDataBtn.disabled = false;
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            muatDataBtn.addEventListener('click', muatDataMurid);
            cetakPukalBtn.addEventListener('click', cetakPukal);
            muatDataMurid();
        });
    </script>
</body>
</html>
